(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"4dGL":function(t,e,o){"use strict";o.r(e),o.d(e,"ScopesModule",(function(){return tt}));var s=o("CSBE"),i=o("ofXK"),r=o("C6Ja"),c=o("NFeN"),a=o("STbY"),n=o("+0xr"),l=o("qFsG"),p=o("d3UM"),d=o("0IaG"),b=o("bTqV"),u=o("J89Z"),m=o("/t3+"),h=o("O8lL"),f=o("mrSG"),g=o("At5g"),C=o("RZmA"),v=o("SY5p"),I=o("fXoL"),y=o("d3yR"),w=o("9ZKQ"),T=o("2ChS"),U=o("tyNb"),O=o("a6VE"),k=o("bv9b");function A(t,e){1&t&&I.Pb(0,"mat-progress-bar",16)}function x(t,e){1&t&&(I.Ub(0,"th",17),I.Ac(1," app "),I.Tb())}function D(t,e){if(1&t&&(I.Ub(0,"td",18),I.Ac(1),I.Tb()),2&t){const t=e.$implicit;I.Cb(1),I.Cc(" ",t.app," ")}}function S(t,e){1&t&&(I.Ub(0,"th",17),I.Ac(1," description "),I.Tb())}function z(t,e){if(1&t&&(I.Ub(0,"td",18),I.Ac(1),I.Tb()),2&t){const t=e.$implicit;I.Cb(1),I.Cc(" ",t.description," ")}}function P(t,e){1&t&&(I.Ub(0,"th",17),I.Ac(1," url "),I.Tb())}function R(t,e){if(1&t&&(I.Ub(0,"td",19),I.Ac(1),I.Tb()),2&t){const t=e.$implicit;I.Cb(1),I.Cc(" ",t.url," ")}}function j(t,e){1&t&&I.Pb(0,"tr",20)}function q(t,e){if(1&t){const t=I.Vb();I.Ub(0,"tr",21),I.cc("click",(function(){I.tc(t);const o=e.$implicit;return I.gc().options(o)})),I.Tb()}}let M=(()=>{class t{constructor(t,e,o,s,i,r){this.menu=t,this.toast=e,this.sheet=o,this.dialog=s,this.router=i,this.service=r,this.sort={key:"description",reverse:!1},this.scopes=new n.k,this.columns=["app","description","url"],this.subscriptions={}}list(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{[this.sort.key]:this.sort.reverse?-1:1},filter:["url","app","role","appId","scopeId","description"]});this.loading=!1,this.scopes.data=t.ok?t.result:[]}))}options(t){return Object(f.a)(this,void 0,void 0,(function*(){const e=yield this.sheet.open(v.a,{data:{role:t.role,title:t.description,options:[{icon:"create",title:"Edit",disabled:[0,1],optionId:0},{icon:"file_copy",title:"Copy",disabled:[0,1,2],optionId:1},{icon:"delete",title:"Delete",disabled:[0,1,2,3,4],optionId:2}]}});yield e.afterDismissed().subscribe(e=>Object(f.a)(this,void 0,void 0,(function*(){if(void 0!==e)switch(e){case 0:this.router.navigate(["/scopes","update",t.scopeId]);break;case 1:this.router.navigate(["/scopes","copy",t.scopeId]);break;case 2:const e=yield this.dialog.open(g.a,{panelClass:"delete-dialog",disableClose:!0});yield e.afterClosed().subscribe(e=>Object(f.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.service.delete({scopeId:t.scopeId});if(this.loading=!1,e.ok){this.toast.success("scope was deleted!");for(let e=0;e<this.scopes.data.length;e++)if(this.scopes.data[e].scopeId==t.scopeId){this.scopes.data.splice(e,1);break}this.scopes.data=JSON.parse(JSON.stringify(this.scopes.data))}else this.toast.error("issue deleting scope!")}})))}})))}))}ngOnInit(){this.list(),this.subscriptions.search=this.search.change.subscribe(t=>{this.scopes.filter=t})}ngOnDestroy(){this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(I.Ob(y.a),I.Ob(w.a),I.Ob(T.b),I.Ob(d.b),I.Ob(U.b),I.Ob(O.a))},t.\u0275cmp=I.Ib({type:t,selectors:[["app-scopes-page"]],viewQuery:function(t,e){var o;1&t&&I.xc(C.a,!0),2&t&&I.qc(o=I.dc())&&(e.search=o.first)},decls:24,vars:5,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-label","spacer"],["placeholder","filter scopes"],["mat-icon-button","","routerLink","add"],["mode","indeterminate","color","accent",4,"ngIf"],[1,"page-body"],["mat-table","",3,"dataSource"],["matColumnDef","app"],["mat-header-cell","","text-uppercase","",4,"matHeaderCellDef"],["mat-cell","","text-uppercase","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","url"],["mat-cell","","text-lowercase","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mode","indeterminate","color","accent"],["mat-header-cell","","text-uppercase",""],["mat-cell","","text-uppercase",""],["mat-cell","","text-lowercase",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){1&t&&(I.Ub(0,"mat-toolbar",0),I.Ub(1,"button",1),I.cc("click",(function(){return e.menu.toggle()})),I.Ub(2,"mat-icon"),I.Ac(3," menu "),I.Tb(),I.Tb(),I.Ub(4,"div",2),I.Ac(5," scopes "),I.Tb(),I.Pb(6,"search",3),I.Ub(7,"button",4),I.Ub(8,"mat-icon"),I.Ac(9," add "),I.Tb(),I.Tb(),I.Tb(),I.zc(10,A,1,0,"mat-progress-bar",5),I.Ub(11,"div",6),I.Ub(12,"table",7),I.Sb(13,8),I.zc(14,x,2,0,"th",9),I.zc(15,D,2,1,"td",10),I.Rb(),I.Sb(16,11),I.zc(17,S,2,0,"th",9),I.zc(18,z,2,1,"td",10),I.Rb(),I.Sb(19,12),I.zc(20,P,2,0,"th",9),I.zc(21,R,2,1,"td",13),I.Rb(),I.zc(22,j,1,0,"tr",14),I.zc(23,q,1,0,"tr",15),I.Tb(),I.Tb()),2&t&&(I.Cb(10),I.nc("ngIf",e.loading),I.Cb(2),I.nc("dataSource",e.scopes),I.Cb(10),I.nc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),I.Cb(1),I.nc("matRowDefColumns",e.columns))},directives:[m.a,b.a,c.a,C.a,U.c,i.l,n.j,n.c,n.e,n.b,n.g,n.i,k.a,n.d,n.a,n.f,n.h],styles:[".mat-column-icon[_ngcontent-%COMP%]{width:60px}.mat-column-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:40px;margin-top:5px;max-height:40px}.mat-row[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();var N=o("AytR"),F=o("3Pt+"),G=o("dWDE"),L=o("xyCQ"),V=o("kmnG"),_=o("FKr1"),J=o("roMP");function $(t,e){1&t&&I.Pb(0,"mat-progress-bar",14)}function E(t,e){if(1&t&&(I.Ub(0,"mat-error"),I.Ac(1),I.Tb()),2&t){const t=I.gc();I.Cb(1),I.Cc(" ",t.errors.description," ")}}function H(t,e){if(1&t&&(I.Ub(0,"mat-error"),I.Ac(1),I.Tb()),2&t){const t=I.gc();I.Cb(1),I.Cc(" ",t.errors.url," ")}}function K(t,e){if(1&t&&(I.Ub(0,"mat-option",15),I.Ac(1),I.Tb()),2&t){const t=e.$implicit;I.nc("value",t.appId),I.Cb(1),I.Cc(" ",t.name," ")}}function Q(t,e){if(1&t&&(I.Ub(0,"mat-error"),I.Ac(1),I.Tb()),2&t){const t=I.gc();I.Cb(1),I.Cc(" ",t.errors.appId," ")}}function Z(t,e){if(1&t&&(I.Ub(0,"mat-option",15),I.Ac(1),I.Tb()),2&t){const t=e.$implicit;I.nc("value",t.value),I.Cb(1),I.Cc(" ",t.title," ")}}function B(t,e){if(1&t&&(I.Ub(0,"mat-error"),I.Ac(1),I.Tb()),2&t){const t=I.gc();I.Cb(1),I.Cc(" ",t.errors.roles," ")}}let X=(()=>{class t{constructor(t,e,o,s,i,r){this.route=t,this.toast=e,this.router=o,this.service=s,this.formerror=i,this.appsservice=r,this.form=new F.d({url:new F.b("",[F.p.required]),appId:new F.b("",[F.p.required]),roles:new F.b(0,[F.p.required]),description:new F.b("",[F.p.required])}),this.errors={url:"",appId:"",roles:"",description:""},this.apps=[],this.roles=N.a.roles,this.subscriptions={}}get(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["url","role","appId","roles","description"],scopeId:this.scopeId});this.loading=!1,t.ok?(t.result.role<3&&(this.router.navigate(["/scopes"]),this.toast.error("you do not have permission to access this scope!")),this.form.controls.url.setValue(t.result.url),this.form.controls.appId.setValue(t.result.appId),this.form.controls.roles.setValue(t.result.roles),this.form.controls.description.setValue(t.result.description)):(this.router.navigate(["/scopes"]),this.toast.error("issue loading scope!")),this.load()}))}load(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.appsservice.list({filter:["name","appId"]});this.loading=!1,t.ok&&(this.apps=t.result)}))}submit(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add"),this.form.disable();const e=yield this.service[t]({url:this.form.value.url,roles:this.form.value.roles,appId:this.form.value.appId,scopeId:this.scopeId,description:this.form.value.description});this.form.enable(),this.loading=!1,e.ok?(this.router.navigate(["/scopes"]),this.toast.success("add"==t?"scope was added!":"scope was updated!")):this.toast.error("add"==t?"there was an issue adding scope!":"there was an issue updating scope!")}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.route=this.route.params.subscribe(t=>{this.mode=t.mode,this.scopeId=t.scopeId,"add"!=this.mode?this.get():this.load()})}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.route.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(I.Ob(U.a),I.Ob(w.a),I.Ob(U.b),I.Ob(O.a),I.Ob(G.a),I.Ob(L.a))},t.\u0275cmp=I.Ib({type:t,selectors:[["app-scope-editor"]],decls:33,vars:14,consts:[["color","primary"],[1,"page-label","spacer"],["mat-icon-button","","routerLink","/scopes"],["mode","indeterminate","color","accent",4,"ngIf"],[3,"formGroup","ngSubmit"],["appearance","outline"],["text-uppercase",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],[4,"ngIf"],["matInput","","type","url","name","url","placeholder","url","formControlName","url","required",""],["name","appId","placeholder","app","formControlName","appId","required",""],[3,"value",4,"ngFor","ngForOf"],["name","roles","placeholder","roles","formControlName","roles","required","","multiple",""],["type","submit","mat-flat-button","","color","primary"],["mode","indeterminate","color","accent"],[3,"value"]],template:function(t,e){1&t&&(I.Ub(0,"mat-toolbar",0),I.Ub(1,"div",1),I.Ac(2),I.Tb(),I.Ub(3,"button",2),I.Ub(4,"mat-icon"),I.Ac(5," close "),I.Tb(),I.Tb(),I.Tb(),I.zc(6,$,1,0,"mat-progress-bar",3),I.Ub(7,"form",4),I.cc("ngSubmit",(function(){return!e.form.invalid&&e.submit()})),I.Ub(8,"mat-form-field",5),I.Ub(9,"mat-label",6),I.Ac(10," description "),I.Tb(),I.Pb(11,"input",7),I.zc(12,E,2,1,"mat-error",8),I.Tb(),I.Ub(13,"mat-form-field",5),I.Ub(14,"mat-label",6),I.Ac(15," url "),I.Tb(),I.Pb(16,"input",9),I.zc(17,H,2,1,"mat-error",8),I.Tb(),I.Ub(18,"mat-form-field",5),I.Ub(19,"mat-label",6),I.Ac(20," app "),I.Tb(),I.Ub(21,"mat-select",10),I.zc(22,K,2,2,"mat-option",11),I.hc(23,"orderBy"),I.Tb(),I.zc(24,Q,2,1,"mat-error",8),I.Tb(),I.Ub(25,"mat-form-field",5),I.Ub(26,"mat-label",6),I.Ac(27," roles "),I.Tb(),I.Ub(28,"mat-select",12),I.zc(29,Z,2,2,"mat-option",11),I.Tb(),I.zc(30,B,2,1,"mat-error",8),I.Tb(),I.Ub(31,"button",13),I.Ac(32," submit "),I.Tb(),I.Tb()),2&t&&(I.Cb(2),I.Ec(" ","add"==e.mode?"add scope":""," ","copy"==e.mode?"copy scope":""," ","update"==e.mode?"update scope":""," "),I.Cb(4),I.nc("ngIf",e.loading),I.Cb(1),I.nc("formGroup",e.form),I.Cb(5),I.nc("ngIf",e.errors.description),I.Cb(5),I.nc("ngIf",e.errors.url),I.Cb(5),I.nc("ngForOf",I.jc(23,11,e.apps,"name")),I.Cb(2),I.nc("ngIf",e.errors.appId),I.Cb(5),I.nc("ngForOf",e.roles),I.Cb(1),I.nc("ngIf",e.errors.roles))},directives:[m.a,b.a,U.c,c.a,i.l,F.q,F.j,F.e,V.c,V.g,l.a,F.a,F.i,F.c,F.o,p.a,i.k,k.a,V.b,_.k],pipes:[J.a],styles:["form[_ngcontent-%COMP%]{width:400px;margin:auto}@media screen and (max-width:420px){form[_ngcontent-%COMP%]{width:calc(100% - 20px)}}"]}),t})();const Y=[{path:"",component:M},{path:":mode",component:X},{path:":mode/:scopeId",component:X}];let W=(()=>{class t{}return t.\u0275mod=I.Mb({type:t}),t.\u0275inj=I.Lb({factory:function(e){return new(e||t)},imports:[[U.e.forChild(Y)],U.e]}),t})(),tt=(()=>{class t{}return t.\u0275mod=I.Mb({type:t}),t.\u0275inj=I.Lb({factory:function(e){return new(e||t)},imports:[[F.f,i.c,s.a,r.a,c.b,a.a,l.b,n.l,p.b,d.c,b.b,u.a,m.b,h.a,V.e,W,F.n,T.c,k.b]]}),t})()}}]);