(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{"4dGL":function(t,i,e){"use strict";e.r(i),e.d(i,"ScopesModule",(function(){return It}));var o=e("mrSG"),s=e("Ovx2");class r{constructor(t){this.app={},this.role=0,void 0!==t&&null!=t&&(void 0!==t.app&&null!=t.app&&(void 0!==t.app.name&&null!=t.app.name&&(this.app.name=t.app.name),void 0!==t.app.icon&&null!=t.app.icon&&(this.app.icon=t.app.icon)),void 0!==t.url&&null!=t.url&&(this.url=t.url),void 0!==t.role&&null!=t.role&&(this.role=t.role),void 0!==t.appId&&null!=t.appId&&(this.appId=t.appId),void 0!==t.scopeId&&null!=t.scopeId&&(this.scopeId=t.scopeId),void 0!==t.description&&null!=t.description&&(this.description=t.description))}}var n=e("Dh3D"),a=e("+0xr"),c=e("3Pt+"),l=e("0IaG"),p=e("fXoL"),d=e("xyCQ"),b=e("dWDE"),u=e("/t3+"),h=e("kmnG"),m=e("bTqV"),f=e("NFeN"),g=e("4jEk"),v=e("ofXK"),I=e("d3UM"),S=e("FKr1"),w=e("WJ5W"),C=e("bv9b"),R=e("AbOq"),A=e("roMP");function y(t,i){1&t&&p.Nb(0,"mat-progress-bar",11)}function k(t,i){if(1&t&&(p.Sb(0,"mat-option",12),p.Cc(1),p.Rb()),2&t){const t=i.$implicit;p.kc("value",t.appId),p.Ab(1),p.Ec(" ",t.name," ")}}function O(t,i){if(1&t&&(p.Sb(0,"mat-error"),p.Cc(1),p.Rb()),2&t){const t=p.ec();p.Ab(1),p.Ec(" ",t.errors.appId," ")}}const M=function(t){return{name:t}};let x=(()=>{class t{constructor(t,i,e,o){this.apps=t,this.dialog=i,this.config=e,this.formerror=o,this.form=new c.f({appId:new c.c([])}),this.errors={appId:""},this.filter=new c.f({app:new c.c("")}),this.subscriptions={}}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["name","appId"]});this.apps.data=t.ok?t.result.map(t=>new s.a(t)):[],void 0!==this.config.appId&&null!=this.config.appId&&this.form.controls.appId.setValue(this.config.appId),this.loading=!1}))}close(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(!1)}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(this.form.value)}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(p.Mb(d.a),p.Mb(l.d),p.Mb(l.a),p.Mb(b.a))},t.\u0275cmp=p.Gb({type:t,selectors:[["scopes-filter-dialog"]],decls:21,vars:13,consts:[[1,"spacer"],["mat-icon-button","",3,"click"],["mode","indeterminate",4,"ngIf"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","appId","formControlName","appId","multiple",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","app"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","submit","color","primary","mat-flat-button",""],["mode","indeterminate"],[3,"value"]],template:function(t,i){1&t&&(p.Sb(0,"mat-toolbar"),p.Sb(1,"mat-label",0),p.Cc(2," Filter Scopes "),p.Rb(),p.Sb(3,"button",1),p.ac("click",(function(){return i.close()})),p.Sb(4,"mat-icon"),p.Cc(5," close "),p.Rb(),p.Rb(),p.Rb(),p.Sb(6,"mat-content"),p.Ac(7,y,1,0,"mat-progress-bar",2),p.Sb(8,"form",3),p.ac("ngSubmit",(function(){return!i.loading&&!i.form.invalid&&i.submit()})),p.Sb(9,"mat-form-field",4),p.Sb(10,"mat-label"),p.Cc(11," App(s) "),p.Rb(),p.Sb(12,"mat-select",5),p.Sb(13,"mat-option",6),p.Nb(14,"ngx-mat-select-search",7),p.Rb(),p.Ac(15,k,2,2,"mat-option",8),p.fc(16,"filterBy"),p.fc(17,"orderBy"),p.Rb(),p.Ac(18,O,2,1,"mat-error",9),p.Rb(),p.Sb(19,"button",10),p.Cc(20," submit "),p.Rb(),p.Rb(),p.Rb()),2&t&&(p.Ab(7),p.kc("ngIf",i.loading),p.Ab(1),p.kc("formGroup",i.form),p.Ab(5),p.kc("formGroup",i.filter),p.Ab(2),p.kc("ngForOf",p.hc(16,5,p.hc(17,8,i.apps.data,"name"),p.mc(11,M,i.filter.value.app))),p.Ab(3),p.kc("ngIf",i.errors.appId))},directives:[u.a,h.g,m.a,f.a,g.a,v.l,c.w,c.p,c.g,h.c,I.a,c.o,c.e,S.k,w.a,v.k,C.a,h.b],pipes:[R.a,A.a],styles:[".filter-dialog{width:500px!important}.filter-dialog .mat-dialog-container{padding:0!important}@media screen and (max-width:600px){.filter-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var P=e("9ZKQ"),j=e("u0tM"),D=e("L7HW"),N=e("tyNb"),E=e("swrf"),F=e("bS1C"),_=e("BhS5"),G=e("a6VE"),q=e("znSr"),H=e("MutI"),$=e("A5z7");function J(t,i){1&t&&p.Nb(0,"mat-progress-bar",14)}function L(t,i){if(1&t){const t=p.Tb();p.Sb(0,"mat-chip",17),p.ac("removed",(function(){p.rc(t);const e=i.$implicit;return p.ec(2).unfilter("appId",e)})),p.Sb(1,"mat-icon"),p.Cc(2," apps "),p.Rb(),p.Sb(3,"mat-label"),p.Cc(4),p.Rb(),p.Sb(5,"mat-icon",18),p.Cc(6," cancel "),p.Rb(),p.Rb()}if(2&t){const t=i.$implicit,e=p.ec(2);p.Ab(4),p.Ec(" ",e.describe(e.apps.data,"appId",t)," ")}}function Q(t,i){if(1&t&&(p.Sb(0,"mat-chip-list",15),p.Ac(1,L,7,1,"mat-chip",16),p.Rb()),2&t){const t=p.ec();p.Ab(1),p.kc("ngForOf",t.filter.appId)}}function V(t,i){1&t&&(p.Sb(0,"th",19),p.Cc(1," App "),p.Rb())}function T(t,i){if(1&t&&(p.Sb(0,"td",20),p.Cc(1),p.Rb()),2&t){const t=i.$implicit;p.Ab(1),p.Ec(" ",t.app.name," ")}}function Z(t,i){1&t&&(p.Sb(0,"th",19),p.Cc(1," Scope "),p.Rb())}function z(t,i){if(1&t&&(p.Sb(0,"td",20),p.Cc(1),p.Rb()),2&t){const t=i.$implicit;p.Ab(1),p.Ec(" ",t.url," ")}}function B(t,i){1&t&&(p.Sb(0,"th",19),p.Cc(1," Description "),p.Rb())}function K(t,i){if(1&t&&(p.Sb(0,"td",20),p.Cc(1),p.Rb()),2&t){const t=i.$implicit;p.Ab(1),p.Ec(" ",t.description," ")}}function W(t,i){1&t&&p.Nb(0,"th",21)}function U(t,i){if(1&t){const t=p.Tb();p.Sb(0,"td",20),p.Sb(1,"button",22),p.ac("click",(function(){p.rc(t);const e=i.$implicit;return p.ec().options(e)})),p.Sb(2,"mat-icon"),p.Cc(3," more_vert "),p.Rb(),p.Rb(),p.Rb()}}function X(t,i){1&t&&p.Nb(0,"tr",23)}function Y(t,i){1&t&&p.Nb(0,"tr",24)}function tt(t,i){if(1&t){const t=p.Tb();p.Sb(0,"mat-list-item",25),p.ac("click",(function(){p.rc(t);const e=i.$implicit;return p.ec().options(e)})),p.Sb(1,"mat-label"),p.Sb(2,"h3"),p.Cc(3),p.Rb(),p.Sb(4,"p"),p.Cc(5),p.Rb(),p.Rb(),p.Rb()}if(2&t){const t=i.$implicit;p.Ab(3),p.Ec(" ",t.app.name," "),p.Ab(2),p.Ec(" ",t.url," ")}}let it=(()=>{class t{constructor(t,i,e,o,s,r,n,c,l,p){this.apps=t,this.toast=i,this.dialog=e,this.sheet=o,this.config=s,this.router=r,this.confirm=n,this.filters=c,this.buttons=l,this.service=p,this.filter=this.filters.get({appId:[]}),this.scopes=new a.k,this.columns=["app","url","description","options"],this.subscriptions={}}list(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({filter:["url","app","role","appId","roles","scopeId","description"],appId:this.filter.appId});this.scopes.data=t.ok?t.result.map(t=>new r(t)):[],this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["name","appId"]});this.apps.data=t.ok?t.result.map(t=>new s.a(t)):[],this.loading=!1}))}unfilter(t,i){this.filter[t]=this.filter[t].filter(t=>t!=i),this.filters.update(this.filter),this.list()}options(t){return Object(o.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.url,options:[{icon:"edit",title:"Edit",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"update",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"content_copy",title:"Copy",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"copy",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.confirm.show({message:"Are you sure you want to delete "+t.url+"?",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const i=yield this.service.delete({scopeId:t.scopeId});if(i.ok){for(let i=0;i<this.scopes.data.length;i++)if(this.scopes.data[i].scopeId==t.scopeId){this.scopes.data.splice(i,1),this.toast.show("Scope was removed!");break}this.scopes.data=JSON.parse(JSON.stringify(this.scopes.data))}else this.toast.show(i.error.message);this.loading=!1}))})})),disabled:[0,1,2,3,4]}]})}))}describe(t,i,e){let o="-";return t.map(t=>{t[i]==e&&(o=t.name)}),o}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.show("filter"),this.buttons.show("search"),this.scopes.sort=this.sort,this.scopes.sort.active="url",this.scopes.sort.direction="asc",this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/scopes","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){t&&(yield this.list(),yield this.load())}))),this.subscriptions.search=this.buttons.search.value.subscribe(t=>{this.scopes.filter=t}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){const t=yield this.dialog.open(x,{data:this.filter,panelClass:"filter-dialog"});yield t.afterClosed().subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){t&&(Object.keys(t).map(i=>{this.filter[i]=t[i]}),this.filters.update(this.filter),this.list())})))})))}ngOnDestroy(){this.buttons.reset("search"),this.subscriptions.add.unsubscribe(),this.subscriptions.loaded.unsubscribe(),this.subscriptions.search.unsubscribe(),this.subscriptions.filter.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(p.Mb(d.a),p.Mb(P.a),p.Mb(l.b),p.Mb(j.a),p.Mb(D.a),p.Mb(N.c),p.Mb(E.a),p.Mb(F.a),p.Mb(_.a),p.Mb(G.a))},t.\u0275cmp=p.Gb({type:t,selectors:[["scopes-page"]],viewQuery:function(t,i){var e;1&t&&p.wc(n.a,!0),2&t&&p.oc(e=p.bc())&&(i.sort=e.first)},decls:19,vars:7,consts:[["mode","indeterminate",4,"ngIf"],["class","filterbar",4,"ngIf"],["mat-table","","fxShow","","fxHide.xs","true","matSort","",3,"dataSource"],["matColumnDef","app"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","url"],["matColumnDef","description"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["fxHide","","fxShow.xs","true"],["lines","full","matRipple","",3,"click",4,"ngFor","ngForOf"],["mode","indeterminate"],[1,"filterbar"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""],["lines","full","matRipple","",3,"click"]],template:function(t,i){1&t&&(p.Ac(0,J,1,0,"mat-progress-bar",0),p.Ac(1,Q,2,1,"mat-chip-list",1),p.Sb(2,"table",2),p.Qb(3,3),p.Ac(4,V,2,0,"th",4),p.Ac(5,T,2,1,"td",5),p.Pb(),p.Qb(6,6),p.Ac(7,Z,2,0,"th",4),p.Ac(8,z,2,1,"td",5),p.Pb(),p.Qb(9,7),p.Ac(10,B,2,0,"th",4),p.Ac(11,K,2,1,"td",5),p.Pb(),p.Qb(12,8),p.Ac(13,W,1,0,"th",9),p.Ac(14,U,4,0,"td",5),p.Pb(),p.Ac(15,X,1,0,"tr",10),p.Ac(16,Y,1,0,"tr",11),p.Rb(),p.Sb(17,"mat-list",12),p.Ac(18,tt,6,2,"mat-list-item",13),p.Rb()),2&t&&(p.kc("ngIf",i.loading),p.Ab(1),p.kc("ngIf",i.filter.appId.length>0),p.Ab(1),p.kc("dataSource",i.scopes),p.Ab(13),p.kc("matHeaderRowDef",i.columns)("matHeaderRowDefSticky",!0),p.Ab(1),p.kc("matRowDefColumns",i.columns),p.Ab(2),p.kc("ngForOf",i.scopes.data))},directives:[v.l,a.j,q.a,n.a,a.c,a.e,a.b,a.g,a.i,H.a,v.k,C.a,$.c,$.a,f.a,h.g,$.d,a.d,n.b,a.a,m.a,a.f,a.h,H.b,S.o],styles:[".mat-column-options[_ngcontent-%COMP%]{width:40px;padding-right:16px!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row}"]}),t})();var et=e("qFsG"),ot=e("ZRfb");function st(t,i){if(1&t&&(p.Sb(0,"mat-error"),p.Cc(1),p.Rb()),2&t){const t=p.ec();p.Ab(1),p.Ec(" ",t.errors.url," ")}}function rt(t,i){if(1&t&&(p.Sb(0,"mat-option",10),p.Cc(1),p.Rb()),2&t){const t=i.$implicit;p.kc("value",t.appId),p.Ab(1),p.Ec(" ",t.name," ")}}function nt(t,i){if(1&t&&(p.Sb(0,"mat-error"),p.Cc(1),p.Rb()),2&t){const t=p.ec();p.Ab(1),p.Ec(" ",t.errors.appId," ")}}function at(t,i){if(1&t&&(p.Sb(0,"mat-error"),p.Cc(1),p.Rb()),2&t){const t=p.ec();p.Ab(1),p.Ec(" ",t.errors.description," ")}}const ct=function(t){return{name:t}};let lt=(()=>{class t{constructor(t,i,e,o,s,r,n){this.apps=t,this.toast=i,this.route=e,this.config=o,this.router=s,this.buttons=r,this.service=n,this.form=new c.f({url:new c.c(null,[c.v.required]),appId:new c.c(null,[c.v.required]),description:new c.c(null,[c.v.required])}),this.errors={url:"",appId:"",description:""},this.filter=new c.f({apps:new c.c("",[c.v.required])}),this.subscriptions={}}get(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["url","role","appId","description"],scopeId:this.scopeId});if(t.ok){const i=new r(t.result);i.role>=2?(this.form.controls.url.setValue(i.url),this.form.controls.appId.setValue(i.appId),this.form.controls.description.setValue(i.description)):(this.toast.show("You have insufficient rights to edit this scope!"),this.router.navigate(["/scopes"]))}else this.toast.show(t.error.message),this.router.navigate(["/scopes"]);this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["role","name","icon","appId"]});t.ok?this.apps.data=t.result.map(t=>new s.a(t)).filter(t=>t.role>=2):(this.apps.data=[],this.toast.show(t.error.message)),this.loading=!1}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.scopeId);const i=yield this.service[t]({url:this.form.value.url,appId:this.form.value.appId,scopeId:this.scopeId,description:this.form.value.description});i.ok?this.router.navigate(["/scopes"]):this.toast.show(i.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/scopes"])}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){if(t){const t=this.route.snapshot.queryParams;this.mode=t.mode,this.scopeId=t.scopeId,"add"!=this.mode?(yield this.get(),yield this.load()):yield this.load()}})))}ngOnDestroy(){this.subscriptions.close.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(p.Mb(d.a),p.Mb(P.a),p.Mb(N.a),p.Mb(D.a),p.Mb(N.c),p.Mb(_.a),p.Mb(G.a))},t.\u0275cmp=p.Gb({type:t,selectors:[["scopes-editor-page"]],decls:24,vars:13,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","type","url","name","url","placeholder","url","formControlName","url","required",""],[4,"ngIf"],["name","appId","placeholder","appId","formControlName","appId","required",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","apps"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[3,"value"]],template:function(t,i){1&t&&(p.Sb(0,"mat-content"),p.Sb(1,"form",0),p.ac("ngSubmit",(function(){return!i.loading&&!i.form.invalid&&i.submit()})),p.Sb(2,"mat-form-field",1),p.Sb(3,"mat-label"),p.Cc(4," Url "),p.Rb(),p.Nb(5,"input",2),p.Ac(6,st,2,1,"mat-error",3),p.Rb(),p.Sb(7,"mat-form-field",1),p.Sb(8,"mat-label"),p.Cc(9," App "),p.Rb(),p.Sb(10,"mat-select",4),p.Sb(11,"mat-option",5),p.Nb(12,"ngx-mat-select-search",6),p.Rb(),p.Ac(13,rt,2,2,"mat-option",7),p.fc(14,"filterBy"),p.Rb(),p.Ac(15,nt,2,1,"mat-error",3),p.Rb(),p.Sb(16,"mat-form-field",1),p.Sb(17,"mat-label"),p.Cc(18," Description "),p.Rb(),p.Nb(19,"input",8),p.Ac(20,at,2,1,"mat-error",3),p.Rb(),p.Rb(),p.Rb(),p.Sb(21,"mat-footer"),p.Sb(22,"button",9),p.ac("click",(function(){return!i.loading&&!i.form.invalid&&i.submit()})),p.Cc(23),p.Rb(),p.Rb()),2&t&&(p.Ab(1),p.kc("formGroup",i.form),p.Ab(5),p.kc("ngIf",i.errors.url),p.Ab(5),p.kc("formGroup",i.filter),p.Ab(2),p.kc("ngForOf",p.hc(14,8,i.apps.data,p.mc(11,ct,i.filter.value.apps))),p.Ab(2),p.kc("ngIf",i.errors.appId),p.Ab(5),p.kc("ngIf",i.errors.description),p.Ab(2),p.kc("disabled",i.form.invalid),p.Ab(1),p.Ec(" ",i.mode," "))},directives:[g.a,c.w,c.p,c.g,h.c,h.g,et.a,c.b,c.o,c.e,c.u,v.l,I.a,S.k,w.a,v.k,ot.a,m.a,h.b],pipes:[R.a],styles:["[upload][_ngcontent-%COMP%]{width:100px;margin:auto;height:100px;border:2px solid transparent;display:flex;align-items:center;border-radius:100%;justify-content:center;background-color:#eee}[upload].required[_ngcontent-%COMP%]{border-color:red}mat-content[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column}mat-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{max-width:400px;margin-top:20px}mat-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;max-width:400px}mat-footer[_ngcontent-%COMP%]{justify-content:center}"]}),t})();var pt=e("wZkO"),dt=e("R32p"),bt=e("gyTc"),ut=e("tVzd"),ht=e("J89Z"),mt=e("YUcS"),ft=e("H0Zp"),gt=e("p/0r");const vt=[{path:"",component:it},{path:"editor",component:lt}];let It=(()=>{class t{}return t.\u0275mod=p.Kb({type:t}),t.\u0275inj=p.Jb({factory:function(i){return new(i||t)},imports:[[c.i,v.c,dt.a,pt.a,f.b,H.c,bt.a,n.c,$.e,a.l,et.b,l.c,ht.a,S.p,I.b,m.b,ut.a,u.b,ft.a,mt.a,gt.a,h.e,c.t,C.b,w.b,N.g.forChild(vt)]]}),t})()}}]);