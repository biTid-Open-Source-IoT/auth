"use strict";(self.webpackChunkauth=self.webpackChunkauth||[]).push([[678],{3678:(re,R,r)=>{r.r(R),r.d(R,{SubscribersPageModule:()=>se});var h=r(5861),f=r(4999),m=r(3075),A=r(8966),t=r(5e3),Y=r(5358),L=r(4733),B=r(7660),K=r(2109),S=r(4594),C=r(7423),Z=r(5245),y=r(9808),U=r(8863),w=r(7093),_=r(7322),N=r(8833),$=r(5664),x=r(3191),g=r(508),H=r(727),q=r(7579),tt=r(9770),T=r(6451),et=r(9646),D=r(4968),V=r(925),O=r(9776),J=r(4115),v=r(1159),ot=r(7429),E=r(5698),Q=r(3900),P=r(9300),it=r(4004),at=r(8505),st=r(1005),nt=r(226);const rt=["panel"];function lt(a,l){if(1&a&&(t.TgZ(0,"div",0,1),t.Hsn(2),t.qZA()),2&a){const e=l.id,o=t.oxw();t.Q6J("id",o.id)("ngClass",o._classList),t.uIk("aria-label",o.ariaLabel||null)("aria-labelledby",o._getPanelAriaLabelledby(e))}}const ct=["*"];let pt=0;class ut{constructor(l,e){this.source=l,this.option=e}}const dt=(0,g.Kr)(class{}),W=new t.OlP("mat-autocomplete-default-options",{providedIn:"root",factory:function(){return{autoActiveFirstOption:!1}}});let ht=(()=>{class a extends dt{constructor(e,o,i,n){super(),this._changeDetectorRef=e,this._elementRef=o,this._activeOptionChanges=H.w0.EMPTY,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new t.vpe,this.opened=new t.vpe,this.closed=new t.vpe,this.optionActivated=new t.vpe,this._classList={},this.id="mat-autocomplete-"+pt++,this.inertGroups=(null==n?void 0:n.SAFARI)||!1,this._autoActiveFirstOption=!!i.autoActiveFirstOption}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=(0,x.Ig)(e)}set classList(e){this._classList=e&&e.length?(0,x.du)(e).reduce((o,i)=>(o[i]=!0,o),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}ngAfterContentInit(){this._keyManager=new $.s1(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const o=new ut(this,e);this.optionSelected.emit(o)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(t.sBO),t.Y36(t.SBq),t.Y36(W),t.Y36(V.t4))},a.\u0275dir=t.lG2({type:a,viewQuery:function(e,o){if(1&e&&(t.Gf(t.Rgc,7),t.Gf(rt,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.template=i.first),t.iGM(i=t.CRH())&&(o.panel=i.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:"autoActiveFirstOption",panelWidth:"panelWidth",classList:["class","classList"]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},features:[t.qOj]}),a})(),ft=(()=>{class a extends ht{constructor(){super(...arguments),this._visibleClass="mat-autocomplete-visible",this._hiddenClass="mat-autocomplete-hidden"}}return a.\u0275fac=function(){let l;return function(o){return(l||(l=t.n5z(a)))(o||a)}}(),a.\u0275cmp=t.Xpm({type:a,selectors:[["mat-autocomplete"]],contentQueries:function(e,o,i){if(1&e&&(t.Suo(i,g.K7,5),t.Suo(i,g.ey,5)),2&e){let n;t.iGM(n=t.CRH())&&(o.optionGroups=n),t.iGM(n=t.CRH())&&(o.options=n)}},hostAttrs:[1,"mat-autocomplete"],inputs:{disableRipple:"disableRipple"},exportAs:["matAutocomplete"],features:[t._Bn([{provide:g.HF,useExisting:a}]),t.qOj],ngContentSelectors:ct,decls:1,vars:0,consts:[["role","listbox",1,"mat-autocomplete-panel",3,"id","ngClass"],["panel",""]],template:function(e,o){1&e&&(t.F$t(),t.YNc(0,lt,3,4,"ng-template"))},directives:[y.mk],styles:[".mat-autocomplete-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;visibility:hidden;max-width:none;max-height:256px;position:relative;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.mat-autocomplete-panel.mat-autocomplete-visible{visibility:visible}.mat-autocomplete-panel.mat-autocomplete-hidden{visibility:hidden}.mat-autocomplete-panel-above .mat-autocomplete-panel{border-radius:0;border-top-left-radius:4px;border-top-right-radius:4px}.mat-autocomplete-panel .mat-divider-horizontal{margin-top:-1px}.cdk-high-contrast-active .mat-autocomplete-panel{outline:solid 1px}mat-autocomplete{display:none}\n"],encapsulation:2,changeDetection:0}),a})();const G=new t.OlP("mat-autocomplete-scroll-strategy"),vt={provide:G,deps:[O.aV],useFactory:function(a){return()=>a.scrollStrategies.reposition()}},bt={provide:m.JU,useExisting:(0,t.Gpc)(()=>j),multi:!0};let yt=(()=>{class a{constructor(e,o,i,n,s,c,u,d,p,b,k){this._element=e,this._overlay=o,this._viewContainerRef=i,this._zone=n,this._changeDetectorRef=s,this._dir=u,this._formField=d,this._document=p,this._viewportRuler=b,this._defaults=k,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=H.w0.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new q.x,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._overlayAttached=!1,this.optionSelections=(0,tt.P)(()=>this.autocomplete&&this.autocomplete.options?(0,T.T)(...this.autocomplete.options.map(ne=>ne.onSelectionChange)):this._zone.onStable.pipe((0,E.q)(1),(0,Q.w)(()=>this.optionSelections))),this._scrollStrategy=c}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=(0,x.Ig)(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay(),this._floatLabel()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this.autocomplete.closed.emit(),this.autocomplete._isOpen=this._overlayAttached=!1,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return(0,T.T)(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe((0,P.h)(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe((0,P.h)(()=>this._overlayAttached)):(0,et.of)()).pipe((0,it.U)(e=>e instanceof g.rN?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return(0,T.T)((0,D.R)(this._document,"click"),(0,D.R)(this._document,"auxclick"),(0,D.R)(this._document,"touchend")).pipe((0,P.h)(e=>{const o=(0,V.sA)(e),i=this._formField?this._formField._elementRef.nativeElement:null,n=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&o!==this._element.nativeElement&&(!i||!i.contains(o))&&(!n||!n.contains(o))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(o)}))}writeValue(e){Promise.resolve(null).then(()=>this._setTriggerValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const o=e.keyCode;if(o===v.hY&&!(0,v.Vb)(e)&&e.preventDefault(),this.activeOption&&o===v.K5&&this.panelOpen)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const i=this.autocomplete._keyManager.activeItem,n=o===v.LH||o===v.JH;this.panelOpen||o===v.Mf?this.autocomplete._keyManager.onKeydown(e):n&&this._canOpen()&&this.openPanel(),(n||this.autocomplete._keyManager.activeItem!==i)&&this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0)}}_handleInput(e){let o=e.target,i=o.value;"number"===o.type&&(i=""==i?null:parseFloat(i)),this._previousValue!==i&&(this._previousValue=i,this._onChange(i),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_floatLabel(e=!1){this._formField&&"auto"===this._formField.floatLabel&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField.floatLabel="auto",this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){const e=this._zone.onStable.pipe((0,E.q)(1)),o=this.autocomplete.options.changes.pipe((0,at.b)(()=>this._positionStrategy.reapplyLastPosition()),(0,st.g)(0));return(0,T.T)(e,o).pipe((0,Q.w)(()=>{const i=this.panelOpen;return this._resetActiveItem(),this.autocomplete._setVisibility(),this.panelOpen&&(this._overlayRef.updatePosition(),i!==this.panelOpen&&this.autocomplete.opened.emit()),this.panelClosingActions}),(0,E.q)(1)).subscribe(i=>this._setValueAndClose(i))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_setTriggerValue(e){const o=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e,i=null!=o?o:"";this._formField?this._formField._control.value=i:this._element.nativeElement.value=i,this._previousValue=i}_setValueAndClose(e){e&&e.source&&(this._clearPreviousSelectedOption(e.source),this._setTriggerValue(e.source.value),this._onChange(e.source.value),this._element.nativeElement.focus(),this.autocomplete._emitSelectEvent(e.source)),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(o=>{o!==e&&o.selected&&o.deselect()})}_attachOverlay(){var e;let o=this._overlayRef;o?(this._positionStrategy.setOrigin(this._getConnectedElement()),o.updateSize({width:this._getPanelWidth()})):(this._portal=new ot.UE(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),o=this._overlay.create(this._getOverlayConfig()),this._overlayRef=o,o.keydownEvents().subscribe(n=>{(n.keyCode===v.hY&&!(0,v.Vb)(n)||n.keyCode===v.LH&&(0,v.Vb)(n,"altKey"))&&(this._closeKeyEventStream.next(),this._resetActiveItem(),n.stopPropagation(),n.preventDefault())}),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&o&&o.updateSize({width:this._getPanelWidth()})})),o&&!o.hasAttached()&&(o.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const i=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&i!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new O.X_({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir,panelClass:null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const o=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],i=this._aboveClass,n=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:i},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:i}];let s;s="above"===this.position?n:"below"===this.position?o:[...o,...n],e.withPositions(s)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this._autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const o=this.autocomplete,i=(0,g.CB)(e,o.options,o.optionGroups);if(0===e&&1===i)o._setScrollTop(0);else if(o.panel){const n=o.options.toArray()[e];if(n){const s=n._getHostElement(),c=(0,g.jH)(s.offsetTop,s.offsetHeight,o._getScrollTop(),o.panel.nativeElement.offsetHeight);o._setScrollTop(c)}}}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(t.SBq),t.Y36(O.aV),t.Y36(t.s_b),t.Y36(t.R0b),t.Y36(t.sBO),t.Y36(G),t.Y36(nt.Is,8),t.Y36(_.G_,9),t.Y36(y.K0,8),t.Y36(J.rL),t.Y36(W,8))},a.\u0275dir=t.lG2({type:a,inputs:{autocomplete:["matAutocomplete","autocomplete"],position:["matAutocompletePosition","position"],connectedTo:["matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["matAutocompleteDisabled","autocompleteDisabled"]},features:[t.TTD]}),a})(),j=(()=>{class a extends yt{constructor(){super(...arguments),this._aboveClass="mat-autocomplete-panel-above"}}return a.\u0275fac=function(){let l;return function(o){return(l||(l=t.n5z(a)))(o||a)}}(),a.\u0275dir=t.lG2({type:a,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-autocomplete-trigger"],hostVars:7,hostBindings:function(e,o){1&e&&t.NdJ("focusin",function(){return o._handleFocus()})("blur",function(){return o._onTouched()})("input",function(n){return o._handleInput(n)})("keydown",function(n){return o._handleKeydown(n)}),2&e&&t.uIk("autocomplete",o.autocompleteAttribute)("role",o.autocompleteDisabled?null:"combobox")("aria-autocomplete",o.autocompleteDisabled?null:"list")("aria-activedescendant",o.panelOpen&&o.activeOption?o.activeOption.id:null)("aria-expanded",o.autocompleteDisabled?null:o.panelOpen.toString())("aria-owns",o.autocompleteDisabled||!o.panelOpen||null==o.autocomplete?null:o.autocomplete.id)("aria-haspopup",!o.autocompleteDisabled)},exportAs:["matAutocompleteTrigger"],features:[t._Bn([bt]),t.qOj]}),a})(),At=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[vt],imports:[[O.U8,g.Ng,g.BQ,y.ez],J.ZD,g.Ng,g.BQ]}),a})();var z=r(4107),_t=r(4080),F=r(5899),Tt=r(3711);function Ot(a,l){1&a&&t._UZ(0,"mat-progress-bar",20)}function Mt(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"mat-option",21),t.NdJ("click",function(){const n=t.CHM(e).$implicit;return t.oxw().setSearchValue(n.id)}),t._uU(1),t.qZA()}if(2&a){const e=l.$implicit;t.Q6J("value",e.description),t.xp6(1),t.hij(" ",e.description," ")}}function St(a,l){if(1&a&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errors.type," ")}}function Ct(a,l){if(1&a&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errors.role," ")}}let Zt=(()=>{class a{constructor(e,o,i,n,s,c){this.apps=e,this.users=o,this.dialog=i,this.groups=n,this.config=s,this.formerror=c,this.form=new m.cw({id:new m.NI(null,[m.kI.required]),role:new m.NI(1,[m.kI.required]),type:new m.NI("app",[m.kI.required]),search:new m.NI(null)}),this.errors={id:"",role:"",type:"",search:""},this.options=[],this.loading=!1,this.searching=!1,this.observers={}}submit(){var e=this;return(0,h.Z)(function*(){delete e.form.value.search,e.form.controls.id.enable(),e.form.controls.type.enable(),e.form.controls.search.enable(),e.dialog.close(e.form.value)})()}search(){var e=this;return(0,h.Z)(function*(){e.searching=!0;let i,o={limit:10};switch(e.form.value.type){case"app":o={filter:["name","appId"],name:e.form.value.search,private:[!0,!1]},i=e.apps;break;case"user":o={filter:["name","userId"],name:e.form.value.search},i=e.users;break;case"group":o={filter:["groupId","description"],private:[!0,!1],description:e.form.value.search},i=e.groups}const n=yield i.list(o);if(n.ok)switch(e.form.value.type){case"app":e.options=n.result.map(s=>({id:s.appId,description:s.name}));break;case"user":e.options=n.result.map(s=>({id:s.userId,description:[s.name.first,s.name.last].join(" ")}));break;case"group":e.options=n.result.map(s=>({id:s.groupId,description:s.description}))}else e.options=[];e.searching=!1})()}setSearchValue(e){this.form.controls.id.setValue(e)}ngOnDestroy(){var e,o;null===(e=this.observers.form)||void 0===e||e.unsubscribe(),null===(o=this.observers.search)||void 0===o||o.unsubscribe()}ngAfterViewInit(){this.mode=this.config.mode;let e=this.config.accesor;"update"==this.config.mode&&(this.form.controls.id.setValue(null==e?void 0:e.id),this.form.controls.id.disable(),this.form.controls.type.setValue(null==e?void 0:e.type),this.form.controls.type.disable(),this.form.controls.role.setValue(null==e?void 0:e.role),this.form.controls.search.setValue(null==e?void 0:e.description),this.form.controls.search.disable()),this.observers.form=this.form.valueChanges.subscribe(o=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.observers.search=this.form.controls.search.valueChanges.subscribe(o=>{void 0!==o&&null!=o&&(null==o?void 0:o.length)>0?setTimeout(()=>this.search(),250):this.options=[]})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(Y.b),t.Y36(L.f),t.Y36(A.so),t.Y36(B.J),t.Y36(A.WI),t.Y36(K.J))},a.\u0275cmp=t.Xpm({type:a,selectors:[["subscribers-editor-dialog"]],decls:46,vars:16,consts:[["mat-icon-button","","mat-dialog-close",""],["for","subscriber editor"],["mode","indeterminate",4,"ngIf"],["fxLayout","row","fxLayoutAlign","center flex-start"],["fxFlex","60","fxFlex.lg","70","fxFlex.md","80","fxFlex.sm","90","fxFlex.xs","100",3,"formGroup","ngSubmit"],["appearance","outline"],["text-capitalize",""],["matInput","","type","text","placeholder","Start typing...","formControlName","search",3,"matAutocomplete"],["search","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["name","type","placeholder","type","formControlName","type","required",""],["value","app"],["value","user"],["value","group"],[4,"ngIf"],["name","role","placeholder","role","formControlName","role","required",""],[3,"value"],["type","submit",2,"display","none"],["button",""],["type","button","mat-flat-button","","color","primary",3,"click"],["mode","indeterminate"],[3,"value","click"]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"mat-toolbar"),t.TgZ(1,"button",0),t.TgZ(2,"mat-icon"),t._uU(3," arrow_back "),t.qZA(),t.qZA(),t.TgZ(4,"label",1),t._uU(5),t.qZA(),t.qZA(),t.YNc(6,Ot,1,0,"mat-progress-bar",2),t.TgZ(7,"mat-content",3),t.TgZ(8,"form",4),t.NdJ("ngSubmit",function(){return!o.loading&&!o.form.invalid&&o.submit()}),t.TgZ(9,"mat-form-field",5),t.TgZ(10,"mat-label",6),t._uU(11),t.qZA(),t._UZ(12,"input",7),t.TgZ(13,"mat-autocomplete",null,8),t.YNc(15,Mt,2,2,"mat-option",9),t.ALo(16,"orderBy"),t.qZA(),t.qZA(),t.TgZ(17,"mat-form-field",5),t.TgZ(18,"mat-label"),t._uU(19," Type "),t.qZA(),t.TgZ(20,"mat-select",10),t.TgZ(21,"mat-option",11),t._uU(22," App "),t.qZA(),t.TgZ(23,"mat-option",12),t._uU(24," User "),t.qZA(),t.TgZ(25,"mat-option",13),t._uU(26," Group "),t.qZA(),t.qZA(),t.YNc(27,St,2,1,"mat-error",14),t.qZA(),t.TgZ(28,"mat-form-field",5),t.TgZ(29,"mat-label"),t._uU(30," Role "),t.qZA(),t.TgZ(31,"mat-select",15),t.TgZ(32,"mat-option",16),t._uU(33," Read "),t.qZA(),t.TgZ(34,"mat-option",16),t._uU(35," Write "),t.qZA(),t.TgZ(36,"mat-option",16),t._uU(37," Read/Write "),t.qZA(),t.TgZ(38,"mat-option",16),t._uU(39," Admin "),t.qZA(),t.qZA(),t.YNc(40,Ct,2,1,"mat-error",14),t.qZA(),t._UZ(41,"button",17,18),t.qZA(),t.qZA(),t.TgZ(43,"mat-footer"),t.TgZ(44,"button",19),t.NdJ("click",function(){return t.CHM(i),t.MAs(42).click()}),t._uU(45," Submit "),t.qZA(),t.qZA()}if(2&e){const i=t.MAs(14);t.xp6(5),t.AsE(" ","add"==o.mode?"Add Subscriber":""," ","update"==o.mode?"Edit Subscriber":""," "),t.xp6(1),t.Q6J("ngIf",o.loading),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(3),t.hij(" Search ",o.form.value.type," "),t.xp6(1),t.Q6J("matAutocomplete",i),t.xp6(3),t.Q6J("ngForOf",t.xi3(16,13,o.options,"description")),t.xp6(12),t.Q6J("ngIf",o.errors.type),t.xp6(5),t.Q6J("value",1),t.xp6(2),t.Q6J("value",2),t.xp6(2),t.Q6J("value",3),t.xp6(2),t.Q6J("value",4),t.xp6(2),t.Q6J("ngIf",o.errors.role)}},directives:[S.Ye,C.lW,A.ZT,Z.Hw,y.O5,U.s,w.xw,w.Wh,m._Y,m.JL,w.yH,m.sg,_.KE,_.hX,N.Nt,m.Fj,j,m.JJ,m.u,ft,y.sg,z.gD,m.Q7,g.ey,_t.A,F.pW,_.TO],pipes:[Tt.T],styles:[""]}),a})();var wt=r(7046),xt=r(2064),Dt=r(5607),M=r(1444),Et=r(213),Pt=r(649),I=r(6696),Ft=r(7563),It=r(8939),kt=r(5167),Rt=r(7756);let Yt=(()=>{class a{constructor(e,o){this.el=e,this.renderer=o}ngOnChanges(){this.renderer.setStyle(this.el.nativeElement,"background-image",["url(",this.src,")"].join(""))}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(t.SBq),t.Y36(t.Qsj))},a.\u0275cmp=t.Xpm({type:a,selectors:[["mat-avatar"]],inputs:{src:"src"},features:[t.TTD],decls:0,vars:0,template:function(e,o){},styles:["mat-avatar{width:40px;height:40px;display:block;border-radius:100%;background-size:cover;background-color:#fafafa;background-repeat:no-repeat;background-position:center center}\n"],encapsulation:2}),a})();function Lt(a,l){1&a&&t._UZ(0,"mat-progress-bar",12)}function Bt(a,l){1&a&&t._UZ(0,"th",13)}function Ut(a,l){if(1&a&&(t.TgZ(0,"td",14),t._UZ(1,"mat-avatar",15),t.qZA()),2&a){const e=l.$implicit;t.xp6(1),t.Q6J("src",e.avatar)}}function Nt(a,l){1&a&&(t.TgZ(0,"th",13),t._uU(1," Description "),t.qZA())}function Ht(a,l){if(1&a&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.xp6(1),t.hij(" ",e.description," ")}}function Vt(a,l){1&a&&(t.TgZ(0,"th",13),t._uU(1," Type "),t.qZA())}function Jt(a,l){if(1&a&&(t.TgZ(0,"td",14),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.qZA()),2&a){const e=l.$implicit;t.xp6(1),t.Tol(e.type),t.xp6(1),t.hij(" ",e.type," ")}}function Qt(a,l){1&a&&(t.TgZ(0,"th",13),t._uU(1," Role "),t.qZA())}function Wt(a,l){if(1&a&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.xp6(1),t.xDo(" ",1==e.role?"Read":""," ",2==e.role?"Write":""," ",3==e.role?"Write/Read":""," ",4==e.role?"Admin":""," ",5==e.role?"Owner":""," ")}}function Gt(a,l){1&a&&t._UZ(0,"tr",16)}function jt(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"tr",17),t.NdJ("click",function(){const n=t.CHM(e).$implicit;return t.oxw().options(n)}),t.qZA()}}const X=function(){return["avatar","description","type","role"]};let zt=(()=>{class a{constructor(e,o,i,n,s,c,u,d,p,b,k){this.apps=e,this.users=o,this.groups=i,this.tokens=n,this.dialog=s,this.toast=c,this.route=u,this.sheet=d,this.config=p,this.router=b,this.confirm=k,this.id="unset",this.role=0,this.type="unset",this.table=new f.by,this.loading=!1,this.observers={}}get(){var e=this;return(0,h.Z)(function*(){e.loading=!0;let i,o={filter:["role","apps","users","groups"]};switch(e.type){case"app":i=e.apps,o.appId=e.id;break;case"group":i=e.groups,o.groupId=e.id;break;case"token":i=e.tokens,o.tokenId=e.id}const n=yield i.get(o);n.ok?(e.table.data=[],e.role=n.result.role,n.result.apps.map(s=>e.table.data.push({id:s.id,type:"app",role:s.role,avatar:"./assets/icons/icon-512x512.png",description:"-"})),n.result.users.map(s=>e.table.data.push({id:s.id,type:"user",role:s.role,avatar:"./assets/icons/icon-512x512.png",description:"-"})),n.result.groups.map(s=>e.table.data.push({id:s.id,type:"group",role:s.role,avatar:"./assets/icons/icon-512x512.png",description:"-"})),e.table.data=e.table.data.map(s=>new M.U(s))):e.toast.show(n.error.message),e.loading=!1})()}load(){var e=this;return(0,h.Z)(function*(){e.loading=!0;const o=yield e.apps.list({filter:["name","icon","appId"],appId:e.table.data.filter(s=>"app"==s.type).map(s=>s.id),private:[!0,!1]});o.ok?(e.apps.data=o.result.map(s=>new wt.g(s)),e.apps.data.map(s=>{for(let c=0;c<e.table.data.length;c++)e.table.data[c].id==s.appId&&"app"==e.table.data[c].type&&(e.table.data[c].avatar=s.icon,e.table.data[c].description=s.name)})):e.apps.data=[];const i=yield e.users.list({filter:["userId","picture","description"],userId:e.table.data.filter(s=>"user"==s.type).map(s=>s.id)});i.ok?(e.users.data=i.result.map(s=>new xt.n(s)),e.users.data.map(s=>{for(let c=0;c<e.table.data.length;c++)e.table.data[c].id==s.userId&&"user"==e.table.data[c].type&&(e.table.data[c].avatar=s.picture,e.table.data[c].description=[s.name.first,s.name.last].join(" "))})):e.users.data=[];const n=yield e.groups.list({filter:["groupId","description"],groupId:e.table.data.filter(s=>"group"==s.type).map(s=>s.id),private:[!0,!1]});n.ok?(e.groups.data=n.result.map(s=>new Dt.Z(s)),e.groups.data.map(s=>{for(let c=0;c<e.table.data.length;c++)e.table.data[c].id==s.groupId&&"group"==e.table.data[c].type&&(e.table.data[c].avatar="./assets/group.png",e.table.data[c].description=s.description)})):e.groups.data=[],e.loading=!1})()}options(e){var o=this;return(0,h.Z)(function*(){let i={edit:!1,delete:!1,makeOwner:!1};var n;(o.role<4||o.role<=e.role)&&(i.edit=!0,i.delete=!0),(o.role<5||5==e.role||"user"!=e.type)&&(i.makeOwner=!0),o.sheet.show({role:o.role,title:e.description,options:[{icon:"edit",title:"Edit",handler:(n=(0,h.Z)(function*(){return o.editor("update",e)}),function(){return n.apply(this,arguments)}),disabled:i.edit?[o.role]:[]},{icon:"remove",title:"Unsubscribe",danger:!0,handler:function(){var n=(0,h.Z)(function*(){var s;o.confirm.show({message:"Are you sure you want to unsubscribe "+e.description+"?",handler:(s=(0,h.Z)(function*(){o.loading=!0;let u,c={id:e.id,type:e.type};switch(o.type){case"app":u=o.apps,c.appId=o.id;break;case"group":u=o.groups,c.groupId=o.id;break;case"token":u=o.tokens,c.tokenId=o.id}const d=yield u.unsubscribe(c);if(d.ok)if(d.result.updated>0){for(let p=0;p<o.table.data.length;p++)if(o.table.data[p].id==e.id&&o.table.data[p].type==e.type){o.table.data.splice(p,1);break}o.table.data=o.table.data.map(p=>new M.U(p))}else o.toast.show("Accesor was not unsubscribed from "+o.type+"!");else o.toast.show(d.error.message);o.loading=!1}),function(){return s.apply(this,arguments)})})});return function(){return n.apply(this,arguments)}}(),disabled:i.delete?[o.role]:[]},{icon:"vpn_key",title:"Make Owner",danger:!0,handler:function(){var n=(0,h.Z)(function*(){var s;o.confirm.show({message:"Are you sure you want to change ownership to "+e.description+"?",handler:(s=(0,h.Z)(function*(){o.loading=!0;let u,c={id:e.id,type:e.type};switch(o.type){case"app":u=o.apps,c.appId=o.id;break;case"group":u=o.groups,c.groupId=o.id;break;case"token":u=o.tokens,c.tokenId=o.id}const d=yield u.changeowner(c);if(d.ok)if(d.result.updated>0){o.table.data.map(p=>{5==p.role&&(p.role=4)});for(let p=0;p<o.table.data.length;p++)if(o.table.data[p].id==e.id&&o.table.data[p].type==e.type){o.table.data[p].role=5;break}o.table.data=o.table.data.map(p=>new M.U(p))}else o.toast.show("Accesor was not set as owner on "+o.type+"!");else o.toast.show(d.error.message);o.loading=!1}),function(){return s.apply(this,arguments)})})});return function(){return n.apply(this,arguments)}}(),disabled:i.makeOwner?[o.role]:[]}]})})()}editor(e,o){var i=this;return(0,h.Z)(function*(){yield(yield i.dialog.open(Zt,{data:{id:i.id,mode:e,type:i.type,accesor:o},panelClass:"fullscreen-dialog"})).afterClosed().subscribe(function(){var s=(0,h.Z)(function*(c){if(c){if("add"==e){i.loading=!0;let d,u={id:c.id,type:c.type,role:c.role};switch(i.type){case"app":d=i.apps,u.appId=i.id;break;case"group":d=i.groups,u.groupId=i.id;break;case"token":d=i.tokens,u.tokenId=i.id}const p=yield d.share(u);p.ok?p.result.updated>0?(i.table.data.push({id:c.id,type:c.type,role:c.role,avatar:"-",description:"-"}),yield i.load()):i.toast.show("Accesor was not added to "+i.type+"!"):i.toast.show(p.error.message),i.loading=!1}else{i.loading=!0;let d,u={id:c.id,type:c.type,role:c.role};switch(i.type){case"app":d=i.apps,u.appId=i.id;break;case"group":d=i.groups,u.groupId=i.id;break;case"token":d=i.tokens,u.tokenId=i.id}const p=yield d.updatesubscriber(u);if(p.ok){for(let b=0;b<i.table.data.length;b++)if(i.table.data[b].id==(null==o?void 0:o.id)&&i.table.data[b].type==(null==o?void 0:o.type)){i.table.data[b].role=c.role;break}}else i.toast.show(p.error.message);i.loading=!1}i.table.data=i.table.data.map(u=>new M.U(u))}});return function(c){return s.apply(this,arguments)}}())})()}ngOnInit(){var e=this;this.observers.loaded=this.config.loaded.subscribe(function(){var o=(0,h.Z)(function*(i){if(i){const n=e.route.snapshot.params;e.id=n.id,e.type=n.type,yield e.get(),yield e.load()}});return function(i){return o.apply(this,arguments)}}())}ngOnDestroy(){var e;null===(e=this.observers.loaded)||void 0===e||e.unsubscribe()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(Y.b),t.Y36(L.f),t.Y36(B.J),t.Y36(Et.H),t.Y36(A.uw),t.Y36(Pt.k),t.Y36(I.gz),t.Y36(Ft.I),t.Y36(It.E),t.Y36(I.F0),t.Y36(kt.z))},a.\u0275cmp=t.Xpm({type:a,selectors:[["subscribers-page"]],decls:24,vars:7,consts:[["for","subscribers"],["mode","indeterminate",4,"ngIf"],["mat-table","",3,"dataSource"],["matColumnDef","avatar"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","type"],["matColumnDef","role"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-fab","","color","primary",1,"add-floating-button",3,"click"],["mode","indeterminate"],["mat-header-cell",""],["mat-cell",""],[3,"src"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-toolbar"),t._UZ(1,"mat-back-button"),t.TgZ(2,"label",0),t._uU(3," Subscribers "),t.qZA(),t.qZA(),t.YNc(4,Lt,1,0,"mat-progress-bar",1),t.TgZ(5,"mat-content"),t.TgZ(6,"table",2),t.ynx(7,3),t.YNc(8,Bt,1,0,"th",4),t.YNc(9,Ut,2,1,"td",5),t.BQk(),t.ynx(10,6),t.YNc(11,Nt,2,0,"th",4),t.YNc(12,Ht,2,1,"td",5),t.BQk(),t.ynx(13,7),t.YNc(14,Vt,2,0,"th",4),t.YNc(15,Jt,3,3,"td",5),t.BQk(),t.ynx(16,8),t.YNc(17,Qt,2,0,"th",4),t.YNc(18,Wt,2,5,"td",5),t.BQk(),t.YNc(19,Gt,1,0,"tr",9),t.YNc(20,jt,1,0,"tr",10),t.qZA(),t.qZA(),t.TgZ(21,"button",11),t.NdJ("click",function(){return o.editor("add")}),t.TgZ(22,"mat-icon"),t._uU(23," add "),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngIf",o.loading),t.xp6(2),t.Q6J("dataSource",o.table),t.xp6(13),t.Q6J("matHeaderRowDef",t.DdM(5,X))("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",t.DdM(6,X)))},directives:[S.Ye,Rt.x,y.O5,U.s,f.BZ,f.w1,f.fO,f.Dz,f.as,f.nj,C.lW,Z.Hw,F.pW,f.ge,f.ev,Yt,f.XQ,f.Gk],styles:[".mat-column-avatar[_ngcontent-%COMP%]{width:60px}span[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px;border-radius:12px;background-color:#fafafa}span.app[_ngcontent-%COMP%]{color:#fff;background-color:#f44336}span.user[_ngcontent-%COMP%]{color:#fff;background-color:#4caf50}span.group[_ngcontent-%COMP%]{color:#fff;background-color:#2196f3}"]}),a})();var Xt=r(7375);let Kt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[y.ez]]}),a})();var $t=r(2217),qt=r(2604),te=r(2155),ee=r(4274),oe=r(1065),ie=r(5896);const ae=[{path:":type/:id",component:zt}];let se=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[m.u5,y.ez,Z.Ps,f.p0,N.c,A.Is,Kt,C.ot,$t.l,z.LD,Xt.M,qt.o,ee.X,S.g0,te.o9,oe.w,_.lN,ie.n,m.UX,F.Cv,At,I.Bz.forChild(ae)]]}),a})()}}]);