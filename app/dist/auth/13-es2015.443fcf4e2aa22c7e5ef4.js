(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"4dGL":function(t,e,o){"use strict";o.r(e),o.d(e,"ScopesModule",(function(){return tt}));var s=o("CSBE"),i=o("ofXK"),r=o("C6Ja"),c=o("NFeN"),a=o("STbY"),n=o("+0xr"),l=o("qFsG"),p=o("d3UM"),d=o("0IaG"),b=o("bTqV"),u=o("J89Z"),m=o("/t3+"),h=o("O8lL"),f=o("mrSG"),g=o("At5g"),y=o("RZmA"),v=o("SY5p"),C=o("fXoL"),I=o("d3yR"),w=o("9ZKQ"),T=o("2ChS"),U=o("tyNb"),x=o("a6VE"),O=o("bv9b");function k(t,e){1&t&&C.Pb(0,"mat-progress-bar",16)}function D(t,e){1&t&&(C.Ub(0,"th",17),C.yc(1," app "),C.Tb())}function S(t,e){if(1&t&&(C.Ub(0,"td",18),C.yc(1),C.Tb()),2&t){const t=e.$implicit;C.Cb(1),C.Ac(" ",t.app," ")}}function P(t,e){1&t&&(C.Ub(0,"th",17),C.yc(1," description "),C.Tb())}function R(t,e){if(1&t&&(C.Ub(0,"td",18),C.yc(1),C.Tb()),2&t){const t=e.$implicit;C.Cb(1),C.Ac(" ",t.description," ")}}function j(t,e){1&t&&(C.Ub(0,"th",17),C.yc(1," url "),C.Tb())}function A(t,e){if(1&t&&(C.Ub(0,"td",19),C.yc(1),C.Tb()),2&t){const t=e.$implicit;C.Cb(1),C.Ac(" ",t.url," ")}}function q(t,e){1&t&&C.Pb(0,"tr",20)}function M(t,e){if(1&t){const t=C.Vb();C.Ub(0,"tr",21),C.cc("click",(function(){C.rc(t);const o=e.$implicit;return C.gc().options(o)})),C.Tb()}}let N=(()=>{class t{constructor(t,e,o,s,i,r){this.menu=t,this.toast=e,this.sheet=o,this.dialog=s,this.router=i,this.service=r,this.sort={key:"description",reverse:!1},this.scopes=new n.k,this.columns=["app","description","url"],this.subscriptions={}}list(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{[this.sort.key]:this.sort.reverse?-1:1},filter:["url","app","role","appId","scopeId","description"]});this.loading=!1,this.scopes.data=t.ok?t.result:[]}))}options(t){return Object(f.a)(this,void 0,void 0,(function*(){const e=yield this.sheet.open(v.a,{data:{role:t.role,title:t.description,options:[{icon:"create",title:"Edit",disabled:[0,1],optionId:0},{icon:"file_copy",title:"Copy",disabled:[0,1,2],optionId:1},{icon:"delete",title:"Delete",disabled:[0,1,2,3,4],optionId:2}]}});yield e.afterDismissed().subscribe(e=>Object(f.a)(this,void 0,void 0,(function*(){if(void 0!==e)switch(e){case 0:this.router.navigate(["/scopes","update",t.scopeId]);break;case 1:this.router.navigate(["/scopes","copy",t.scopeId]);break;case 2:const e=yield this.dialog.open(g.a,{panelClass:"delete-dialog",disableClose:!0});yield e.afterClosed().subscribe(e=>Object(f.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.service.delete({scopeId:t.scopeId});if(this.loading=!1,e.ok){this.toast.success("scope was deleted!");for(let e=0;e<this.scopes.data.length;e++)if(this.scopes.data[e].scopeId==t.scopeId){this.scopes.data.splice(e,1);break}this.scopes.data=JSON.parse(JSON.stringify(this.scopes.data))}else this.toast.error("issue deleting scope!")}})))}})))}))}ngOnInit(){this.list(),this.subscriptions.search=this.search.change.subscribe(t=>{this.scopes.filter=t})}ngOnDestroy(){this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(C.Ob(I.a),C.Ob(w.a),C.Ob(T.b),C.Ob(d.b),C.Ob(U.b),C.Ob(x.a))},t.\u0275cmp=C.Ib({type:t,selectors:[["app-scopes-page"]],viewQuery:function(t,e){var o;1&t&&C.vc(y.a,!0),2&t&&C.oc(o=C.dc())&&(e.search=o.first)},decls:24,vars:5,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-label","spacer"],["placeholder","filter scopes"],["mat-icon-button","","routerLink","add"],["mode","indeterminate","color","accent",4,"ngIf"],[1,"page-body"],["mat-table","",3,"dataSource"],["matColumnDef","app"],["mat-header-cell","","text-uppercase","",4,"matHeaderCellDef"],["mat-cell","","text-uppercase","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","url"],["mat-cell","","text-lowercase","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mode","indeterminate","color","accent"],["mat-header-cell","","text-uppercase",""],["mat-cell","","text-uppercase",""],["mat-cell","","text-lowercase",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){1&t&&(C.Ub(0,"mat-toolbar",0),C.Ub(1,"button",1),C.cc("click",(function(){return e.menu.toggle()})),C.Ub(2,"mat-icon"),C.yc(3," menu "),C.Tb(),C.Tb(),C.Ub(4,"div",2),C.yc(5," scopes "),C.Tb(),C.Pb(6,"search",3),C.Ub(7,"button",4),C.Ub(8,"mat-icon"),C.yc(9," add "),C.Tb(),C.Tb(),C.Tb(),C.xc(10,k,1,0,"mat-progress-bar",5),C.Ub(11,"div",6),C.Ub(12,"table",7),C.Sb(13,8),C.xc(14,D,2,0,"th",9),C.xc(15,S,2,1,"td",10),C.Rb(),C.Sb(16,11),C.xc(17,P,2,0,"th",9),C.xc(18,R,2,1,"td",10),C.Rb(),C.Sb(19,12),C.xc(20,j,2,0,"th",9),C.xc(21,A,2,1,"td",13),C.Rb(),C.xc(22,q,1,0,"tr",14),C.xc(23,M,1,0,"tr",15),C.Tb(),C.Tb()),2&t&&(C.Cb(10),C.nc("ngIf",e.loading),C.Cb(2),C.nc("dataSource",e.scopes),C.Cb(10),C.nc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),C.Cb(1),C.nc("matRowDefColumns",e.columns))},directives:[m.a,b.a,c.a,y.a,U.c,i.l,n.j,n.c,n.e,n.b,n.g,n.i,O.a,n.d,n.a,n.f,n.h],styles:[".mat-column-icon[_ngcontent-%COMP%]{width:60px}.mat-column-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:40px;margin-top:5px;max-height:40px}.mat-row[_ngcontent-%COMP%]{cursor:pointer}"]}),t})();var F=o("AytR"),G=o("3Pt+"),L=o("dWDE"),V=o("xyCQ"),_=o("kmnG"),J=o("FKr1"),$=o("roMP");function H(t,e){1&t&&C.Pb(0,"mat-progress-bar",14)}function E(t,e){if(1&t&&(C.Ub(0,"mat-error"),C.yc(1),C.Tb()),2&t){const t=C.gc();C.Cb(1),C.Ac(" ",t.errors.description," ")}}function K(t,e){if(1&t&&(C.Ub(0,"mat-error"),C.yc(1),C.Tb()),2&t){const t=C.gc();C.Cb(1),C.Ac(" ",t.errors.url," ")}}function Q(t,e){if(1&t&&(C.Ub(0,"mat-option",15),C.yc(1),C.Tb()),2&t){const t=e.$implicit;C.nc("value",t.appId),C.Cb(1),C.Ac(" ",t.name," ")}}function Z(t,e){if(1&t&&(C.Ub(0,"mat-error"),C.yc(1),C.Tb()),2&t){const t=C.gc();C.Cb(1),C.Ac(" ",t.errors.appId," ")}}function B(t,e){if(1&t&&(C.Ub(0,"mat-option",15),C.yc(1),C.Tb()),2&t){const t=e.$implicit;C.nc("value",t.value),C.Cb(1),C.Ac(" ",t.title," ")}}function X(t,e){if(1&t&&(C.Ub(0,"mat-error"),C.yc(1),C.Tb()),2&t){const t=C.gc();C.Cb(1),C.Ac(" ",t.errors.roles," ")}}let Y=(()=>{class t{constructor(t,e,o,s,i,r){this.route=t,this.toast=e,this.router=o,this.service=s,this.formerror=i,this.appsservice=r,this.form=new G.d({url:new G.b("",[G.p.required]),appId:new G.b("",[G.p.required]),roles:new G.b(0,[G.p.required]),description:new G.b("",[G.p.required])}),this.errors={url:"",appId:"",roles:"",description:""},this.apps=[],this.roles=F.a.roles,this.subscriptions={}}get(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["url","role","appId","roles","description"],scopeId:this.scopeId});this.loading=!1,t.ok?(t.result.role<3&&(this.router.navigate(["/scopes"]),this.toast.error("you do not have permission to access this scope!")),this.form.controls.url.setValue(t.result.url),this.form.controls.appId.setValue(t.result.appId),this.form.controls.roles.setValue(t.result.roles),this.form.controls.description.setValue(t.result.description)):(this.router.navigate(["/scopes"]),this.toast.error("issue loading scope!")),this.load()}))}load(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.appsservice.list({filter:["name","appId"]});this.loading=!1,t.ok&&(this.apps=t.result)}))}submit(){return Object(f.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add"),this.form.disable();const e=yield this.service[t]({url:this.form.value.url,roles:this.form.value.roles,appId:this.form.value.appId,scopeId:this.scopeId,description:this.form.value.description});this.form.enable(),this.loading=!1,e.ok?(this.router.navigate(["/scopes"]),this.toast.success("add"==t?"scope was added!":"scope was updated!")):this.toast.error("add"==t?"there was an issue adding scope!":"there was an issue updating scope!")}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.subscriptions.route=this.route.params.subscribe(t=>{this.mode=t.mode,this.scopeId=t.scopeId,"add"!=this.mode?this.get():this.load()})}ngOnDestroy(){this.subscriptions.form.unsubscribe(),this.subscriptions.route.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(C.Ob(U.a),C.Ob(w.a),C.Ob(U.b),C.Ob(x.a),C.Ob(L.a),C.Ob(V.a))},t.\u0275cmp=C.Ib({type:t,selectors:[["app-scope-editor"]],decls:33,vars:14,consts:[["color","primary"],[1,"page-label","spacer"],["mat-icon-button","","routerLink","/scopes"],["mode","indeterminate","color","accent",4,"ngIf"],[3,"formGroup","ngSubmit"],["appearance","outline"],["text-uppercase",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],[4,"ngIf"],["matInput","","type","url","name","url","placeholder","url","formControlName","url","required",""],["name","appId","placeholder","app","formControlName","appId","required",""],[3,"value",4,"ngFor","ngForOf"],["name","roles","placeholder","roles","formControlName","roles","required","","multiple",""],["type","submit","mat-flat-button","","color","primary"],["mode","indeterminate","color","accent"],[3,"value"]],template:function(t,e){1&t&&(C.Ub(0,"mat-toolbar",0),C.Ub(1,"div",1),C.yc(2),C.Tb(),C.Ub(3,"button",2),C.Ub(4,"mat-icon"),C.yc(5," close "),C.Tb(),C.Tb(),C.Tb(),C.xc(6,H,1,0,"mat-progress-bar",3),C.Ub(7,"form",4),C.cc("ngSubmit",(function(){return!e.form.invalid&&e.submit()})),C.Ub(8,"mat-form-field",5),C.Ub(9,"mat-label",6),C.yc(10," description "),C.Tb(),C.Pb(11,"input",7),C.xc(12,E,2,1,"mat-error",8),C.Tb(),C.Ub(13,"mat-form-field",5),C.Ub(14,"mat-label",6),C.yc(15," url "),C.Tb(),C.Pb(16,"input",9),C.xc(17,K,2,1,"mat-error",8),C.Tb(),C.Ub(18,"mat-form-field",5),C.Ub(19,"mat-label",6),C.yc(20," app "),C.Tb(),C.Ub(21,"mat-select",10),C.xc(22,Q,2,2,"mat-option",11),C.hc(23,"orderBy"),C.Tb(),C.xc(24,Z,2,1,"mat-error",8),C.Tb(),C.Ub(25,"mat-form-field",5),C.Ub(26,"mat-label",6),C.yc(27," roles "),C.Tb(),C.Ub(28,"mat-select",12),C.xc(29,B,2,2,"mat-option",11),C.Tb(),C.xc(30,X,2,1,"mat-error",8),C.Tb(),C.Ub(31,"button",13),C.yc(32," submit "),C.Tb(),C.Tb()),2&t&&(C.Cb(2),C.Cc(" ","add"==e.mode?"add scope":""," ","copy"==e.mode?"copy scope":""," ","update"==e.mode?"update scope":""," "),C.Cb(4),C.nc("ngIf",e.loading),C.Cb(1),C.nc("formGroup",e.form),C.Cb(5),C.nc("ngIf",e.errors.description),C.Cb(5),C.nc("ngIf",e.errors.url),C.Cb(5),C.nc("ngForOf",C.jc(23,11,e.apps,"name")),C.Cb(2),C.nc("ngIf",e.errors.appId),C.Cb(5),C.nc("ngForOf",e.roles),C.Cb(1),C.nc("ngIf",e.errors.roles))},directives:[m.a,b.a,U.c,c.a,i.l,G.q,G.j,G.e,_.c,_.g,l.a,G.a,G.i,G.c,G.o,p.a,i.k,O.a,_.b,J.k],pipes:[$.a],styles:["form[_ngcontent-%COMP%]{width:400px;margin:auto}@media screen and (max-width:420px){form[_ngcontent-%COMP%]{width:calc(100% - 20px)}}"]}),t})();const W=[{path:"",component:N},{path:":mode",component:Y},{path:":mode/:scopeId",component:Y}];let z=(()=>{class t{}return t.\u0275mod=C.Mb({type:t}),t.\u0275inj=C.Lb({factory:function(e){return new(e||t)},imports:[[U.e.forChild(W)],U.e]}),t})(),tt=(()=>{class t{}return t.\u0275mod=C.Mb({type:t}),t.\u0275inj=C.Lb({factory:function(e){return new(e||t)},imports:[[G.f,i.c,s.a,r.a,c.b,a.a,l.b,n.l,p.b,d.c,b.b,u.a,m.b,h.a,_.e,z,G.n,T.c,O.b]]}),t})()}}]);