(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{Pn0e:function(t,e,i){"use strict";i.r(e),i.d(e,"SubscribersModule",(function(){return J}));var s=i("mrSG"),o=i("0IaG"),r=i("3Pt+"),a=i("fXoL"),n=i("dWDE"),c=i("/t3+"),l=i("kmnG"),b=i("bTqV"),d=i("NFeN"),u=i("qFsG"),m=i("ofXK"),h=i("d3UM"),p=i("FKr1");function f(t,e){if(1&t&&(a.Rb(0,"mat-error"),a.Ac(1),a.Qb()),2&t){const t=a.dc();a.Ab(1),a.Cc(" ",t.errors.email," ")}}function g(t,e){if(1&t&&(a.Rb(0,"mat-error"),a.Ac(1),a.Qb()),2&t){const t=a.dc();a.Ab(1),a.Cc(" ",t.errors.role," ")}}let R=(()=>{class t{constructor(t,e,i){this.dialog=t,this.config=e,this.formerror=i,this.form=new r.f({role:new r.c(1,[r.v.required]),email:new r.c(null,[r.v.required,r.v.email])}),this.errors={role:"",email:""},this.subscribers={}}close(){this.dialog.close(!1)}submit(){this.dialog.close(this.form.value)}ngOnInit(){this.subscribers.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),null!=this.config&&(null!=this.config.role&&this.form.controls.role.setValue(this.config.role),null!=this.config.email&&(this.form.controls.email.setValue(this.config.email),this.form.controls.email.disable()))}ngOnDestroy(){this.subscribers.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(o.d),a.Lb(o.a),a.Lb(n.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["user-editor-dialog"]],decls:29,vars:8,consts:[[1,"spacer"],["type","button","mat-icon-button","",3,"click"],[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","type","email","name","email","placeholder","email","formControlName","email","required",""],[4,"ngIf"],["name","role","placeholder","role","formControlName","role","required",""],[3,"value"],["disabled","",3,"value"],["type","submit","mat-flat-button","","color","primary"]],template:function(t,e){1&t&&(a.Rb(0,"mat-toolbar"),a.Rb(1,"mat-label",0),a.Ac(2," Manage User "),a.Qb(),a.Rb(3,"button",1),a.Zb("click",(function(){return e.close()})),a.Rb(4,"mat-icon"),a.Ac(5,"close"),a.Qb(),a.Qb(),a.Qb(),a.Rb(6,"form",2),a.Zb("ngSubmit",(function(){return!e.form.invalid&&e.submit()})),a.Rb(7,"mat-form-field",3),a.Rb(8,"mat-label"),a.Ac(9," Email "),a.Qb(),a.Mb(10,"input",4),a.yc(11,f,2,1,"mat-error",5),a.Qb(),a.Rb(12,"mat-form-field",3),a.Rb(13,"mat-label"),a.Ac(14," Role "),a.Qb(),a.Rb(15,"mat-select",6),a.Rb(16,"mat-option",7),a.Ac(17," Read "),a.Qb(),a.Rb(18,"mat-option",7),a.Ac(19," Write "),a.Qb(),a.Rb(20,"mat-option",7),a.Ac(21," Read/Write "),a.Qb(),a.Rb(22,"mat-option",7),a.Ac(23," Admin "),a.Qb(),a.Rb(24,"mat-option",8),a.Ac(25," Owner "),a.Qb(),a.Qb(),a.yc(26,g,2,1,"mat-error",5),a.Qb(),a.Rb(27,"button",9),a.Ac(28," submit "),a.Qb(),a.Qb()),2&t&&(a.Ab(6),a.jc("formGroup",e.form),a.Ab(5),a.jc("ngIf",e.errors.email),a.Ab(5),a.jc("value",1),a.Ab(2),a.jc("value",2),a.Ab(2),a.jc("value",3),a.Ab(2),a.jc("value",4),a.Ab(2),a.jc("value",5),a.Ab(2),a.jc("ngIf",e.errors.role))},directives:[c.a,l.f,b.a,d.a,r.w,r.p,r.g,l.c,u.a,r.b,r.o,r.e,r.u,m.l,h.a,p.k,l.b],styles:[".user-editor-dialog{width:500px!important}.user-editor-dialog .mat-dialog-container{padding:0 0 10px!important}.user-editor-dialog .mat-dialog-container mat-toolbar{display:flex;font-size:14px;margin-bottom:5px;justify-content:center}@media screen and (max-width:600px){.user-editor-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var A=i("+0xr"),w=i("xyCQ"),y=i("L7HW"),Q=i("9ZKQ"),k=i("tyNb"),v=i("BhS5"),j=i("RgeU"),O=i("znSr"),C=i("MutI");function S(t,e){1&t&&(a.Rb(0,"th",10),a.Ac(1," Email "),a.Qb())}function x(t,e){if(1&t&&(a.Rb(0,"td",11),a.Ac(1),a.Qb()),2&t){const t=e.$implicit;a.Ab(1),a.Cc(" ",t.email," ")}}function M(t,e){1&t&&(a.Rb(0,"th",10),a.Ac(1," Role "),a.Qb())}function I(t,e){if(1&t){const t=a.Sb();a.Rb(0,"td",11),a.Rb(1,"mat-select",12),a.Zb("ngModelChange",(function(i){return a.qc(t),e.$implicit.role=i}))("ngModelChange",(function(i){a.qc(t);const s=e.$implicit;return a.dc().updatesubscriber(s.email,i)})),a.Rb(2,"mat-option",13),a.Ac(3," Read "),a.Qb(),a.Rb(4,"mat-option",13),a.Ac(5," Write "),a.Qb(),a.Rb(6,"mat-option",13),a.Ac(7," Read/Write "),a.Qb(),a.Rb(8,"mat-option",13),a.Ac(9," Admin "),a.Qb(),a.Rb(10,"mat-option",14),a.Ac(11," Owner "),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit,i=a.dc();a.Ab(1),a.jc("ngModel",t.role)("disabled",i.role<4||t.role>=i.role||5==t.role),a.Ab(1),a.jc("value",1),a.Ab(2),a.jc("value",2),a.Ab(2),a.jc("value",3),a.Ab(2),a.jc("value",4),a.Ab(2),a.jc("value",5)}}function D(t,e){1&t&&a.Mb(0,"th",10)}function q(t,e){if(1&t){const t=a.Sb();a.Rb(0,"td",11),a.Rb(1,"button",15),a.Zb("click",(function(){a.qc(t);const i=e.$implicit;return a.dc().unsubscribe(i.email)})),a.Rb(2,"mat-icon"),a.Ac(3," delete "),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit,i=a.dc();a.Ab(1),a.jc("disabled",i.role<4||t.role>=i.role||5==t.role)}}function L(t,e){1&t&&a.Mb(0,"tr",16)}function P(t,e){1&t&&a.Mb(0,"tr",17)}function F(t,e){if(1&t){const t=a.Sb();a.Rb(0,"mat-list-item",18),a.Rb(1,"mat-label"),a.Rb(2,"h3"),a.Ac(3),a.Qb(),a.Rb(4,"p"),a.Ac(5),a.Qb(),a.Qb(),a.Rb(6,"button",19),a.Zb("click",(function(){a.qc(t);const i=e.$implicit;return a.dc().editor(i)})),a.Rb(7,"mat-icon"),a.Ac(8," edit "),a.Qb(),a.Qb(),a.Rb(9,"button",15),a.Zb("click",(function(){a.qc(t);const i=e.$implicit;return a.dc().unsubscribe(i.email)})),a.Rb(10,"mat-icon"),a.Ac(11," delete "),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit,i=a.dc();a.Ab(3),a.Cc(" ",t.email," "),a.Ab(2),a.Ec(" ",1==t.role?"Read":""," ",2==t.role?"Write":""," ",3==t.role?"Read/Write":""," ",4==t.role?"Admin":""," ",5==t.role?"Owner":""," "),a.Ab(1),a.jc("disabled",i.role<4||t.role>=i.role||5==t.role),a.Ab(3),a.jc("disabled",i.role<4||t.role>=i.role||5==t.role)}}let H=(()=>{class t{constructor(t,e,i,s,o,r,a){this.apps=t,this.config=e,this.dialog=i,this.toast=s,this.route=o,this.buttons=r,this.tokens=a,this.users=new A.k,this.columns=["email","role","options"],this.subscriptions={}}get(){return Object(s.a)(this,void 0,void 0,(function*(){this.loading=!0;const t={filter:["role","users"]};let e;switch(this.type){case"app":e=this.apps,t.appId=this.id;break;case"token":e=this.tokens,t.tokenId=this.id}const i=yield e.get(t);i.ok?(this.role=i.result.role,this.users.data=i.result.users):this.users.data=[],this.loading=!1}))}share(t){return Object(s.a)(this,void 0,void 0,(function*(){this.loading=!0;const e={role:t.role,email:t.email};let i;switch(this.type){case"app":i=this.apps,e.appId=this.id;break;case"token":i=this.tokens,e.tokenId=this.id}const s=yield i.share(e);s.ok?(this.users.data.push(t),this.users.data=JSON.parse(JSON.stringify(this.users.data)),this.toast.show("User was shared!")):this.toast.show(s.error.message),this.loading=!1}))}editor(t){return Object(s.a)(this,void 0,void 0,(function*(){(yield this.dialog.open(R,{data:t,panelClass:"user-editor-dialog"})).afterClosed().subscribe(e=>{e&&(t?this.updatesubscriber(t.email,e.role):this.share(e))})}))}unsubscribe(t){return Object(s.a)(this,void 0,void 0,(function*(){this.loading=!0;const e={email:t};let i;switch(this.type){case"app":i=this.apps,e.appId=this.id;break;case"token":i=this.tokens,e.tokenId=this.id}const s=yield i.unsubscribe(e);if(s.ok){for(let e=0;e<this.users.data.length;e++)this.users.data[e].email==t&&this.users.data.splice(e,1);this.users.data=JSON.parse(JSON.stringify(this.users.data)),this.toast.show("User was removed!")}else this.toast.show(s.error.message);this.loading=!1}))}updatesubscriber(t,e){return Object(s.a)(this,void 0,void 0,(function*(){this.loading=!0;const i={role:e,email:t};let s;switch(this.type){case"app":s=this.apps,i.appId=this.id;break;case"token":s=this.tokens,i.tokenId=this.id}const o=yield s.updatesubscriber(i);this.toast.show(o.ok?"User was updated!":o.error.message),this.loading=!1}))}ngOnInit(){this.buttons.show("add"),this.buttons.show("close"),this.buttons.hide("search"),this.buttons.hide("filter"),this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.editor()}),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{window.history.back()}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>{if(t){const t=this.route.snapshot.queryParams;this.id=t.id,this.type=t.type,this.get()}})}ngOnDestroy(){this.subscriptions.add.unsubscribe(),this.subscriptions.close.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(w.a),a.Lb(y.a),a.Lb(o.b),a.Lb(Q.a),a.Lb(k.a),a.Lb(v.a),a.Lb(j.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["subscribers-page"]],decls:14,vars:5,consts:[["mat-table","","fxShow","","fxHide.xs","true",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","role"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["fxHide","","fxShow.xs","true"],["lines","full",4,"ngFor","ngForOf"],["mat-header-cell",""],["mat-cell",""],["required","",3,"ngModel","disabled","ngModelChange"],[3,"value"],["disabled","",3,"value"],["mat-icon-button","","color","warn",3,"disabled","click"],["mat-header-row",""],["mat-row",""],["lines","full"],["mat-icon-button","",3,"disabled","click"]],template:function(t,e){1&t&&(a.Rb(0,"table",0),a.Pb(1,1),a.yc(2,S,2,0,"th",2),a.yc(3,x,2,1,"td",3),a.Ob(),a.Pb(4,4),a.yc(5,M,2,0,"th",2),a.yc(6,I,12,7,"td",3),a.Ob(),a.Pb(7,5),a.yc(8,D,1,0,"th",2),a.yc(9,q,4,1,"td",3),a.Ob(),a.yc(10,L,1,0,"tr",6),a.yc(11,P,1,0,"tr",7),a.Qb(),a.Rb(12,"mat-list",8),a.yc(13,F,12,8,"mat-list-item",9),a.Qb()),2&t&&(a.jc("dataSource",e.users),a.Ab(10),a.jc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),a.Ab(1),a.jc("matRowDefColumns",e.columns),a.Ab(2),a.jc("ngForOf",e.users.data))},directives:[A.j,O.a,A.c,A.e,A.b,A.g,A.i,C.a,m.k,A.d,A.a,h.a,r.u,r.o,r.r,p.k,b.a,d.a,A.f,A.h,C.b,l.f],styles:[".mat-column-options[_ngcontent-%COMP%]{width:40px;padding-right:16px!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{width:100%}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]   mat-label[_ngcontent-%COMP%]{margin-right:auto}"]}),t})();var N=i("wZkO"),Z=i("YUcS"),$=i("H0Zp");const W=[{path:"",component:H}];let J=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},imports:[[r.i,m.c,N.a,d.b,C.c,A.l,u.b,p.p,o.c,b.b,h.b,$.a,c.b,Z.a,l.e,r.t,k.f.forChild(W)]]}),t})()}}]);