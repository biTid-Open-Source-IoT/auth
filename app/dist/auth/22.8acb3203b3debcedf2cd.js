(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"4dGL":function(t,e,o){"use strict";o.r(e),o.d(e,"ScopesModule",(function(){return it}));var i=o("mrSG");class s{constructor(t){this.app={},this.role=0,null!=t&&(null!=t.app&&(null!=t.app.name&&(this.app.name=t.app.name),null!=t.app.icon&&(this.app.icon=t.app.icon)),null!=t.url&&(this.url=t.url),null!=t.role&&(this.role=t.role),null!=t.appId&&(this.appId=t.appId),null!=t.scopeId&&(this.scopeId=t.scopeId),null!=t.description&&(this.description=t.description))}}var n=o("Dh3D"),r=o("+0xr"),c=o("fXoL"),a=o("9ZKQ"),l=o("u0tM"),d=o("L7HW"),p=o("tyNb"),u=o("swrf"),b=o("BhS5"),h=o("a6VE"),m=o("znSr"),f=o("MutI"),g=o("ofXK"),v=o("bTqV"),w=o("NFeN"),S=o("FKr1"),I=o("kmnG");function y(t,e){1&t&&(c.Sb(0,"th",12),c.Bc(1," App "),c.Rb())}function R(t,e){if(1&t&&(c.Sb(0,"td",13),c.Bc(1),c.Rb()),2&t){const t=e.$implicit;c.Ab(1),c.Dc(" ",t.app.name," ")}}function k(t,e){1&t&&(c.Sb(0,"th",12),c.Bc(1," Scope "),c.Rb())}function O(t,e){if(1&t&&(c.Sb(0,"td",13),c.Bc(1),c.Rb()),2&t){const t=e.$implicit;c.Ab(1),c.Dc(" ",t.url," ")}}function M(t,e){1&t&&(c.Sb(0,"th",12),c.Bc(1," Description "),c.Rb())}function C(t,e){if(1&t&&(c.Sb(0,"td",13),c.Bc(1),c.Rb()),2&t){const t=e.$implicit;c.Ab(1),c.Dc(" ",t.description," ")}}function D(t,e){1&t&&c.Nb(0,"th",14)}function x(t,e){if(1&t){const t=c.Tb();c.Sb(0,"td",13),c.Sb(1,"button",15),c.ac("click",(function(){c.rc(t);const o=e.$implicit;return c.ec().options(o)})),c.Sb(2,"mat-icon"),c.Bc(3," more_vert "),c.Rb(),c.Rb(),c.Rb()}}function P(t,e){1&t&&c.Nb(0,"tr",16)}function A(t,e){1&t&&c.Nb(0,"tr",17)}function B(t,e){if(1&t){const t=c.Tb();c.Sb(0,"mat-list-item",18),c.ac("click",(function(){c.rc(t);const o=e.$implicit;return c.ec().options(o)})),c.Sb(1,"mat-label"),c.Sb(2,"h3"),c.Bc(3),c.Rb(),c.Sb(4,"p"),c.Bc(5),c.Rb(),c.Rb(),c.Rb()}if(2&t){const t=e.$implicit;c.Ab(3),c.Dc(" ",t.app.name," "),c.Ab(2),c.Dc(" ",t.url," ")}}let _=(()=>{class t{constructor(t,e,o,i,s,n,c){this.toast=t,this.sheet=e,this.config=o,this.router=i,this.confirm=s,this.buttons=n,this.service=c,this.scopes=new r.k,this.columns=["app","url","description","options"],this.subscriptions={}}list(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({filter:["url","app","role","appId","roles","scopeId","description"]});this.scopes.data=t.ok?t.result.map(t=>new s(t)):[],this.loading=!1}))}options(t){return Object(i.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.url,options:[{icon:"edit",title:"Edit",handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"update",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"content_copy",title:"Copy",handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"copy",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.confirm.show({message:"Are you sure you want to delete "+t.url+"?",handler:()=>Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({scopeId:t.scopeId});if(e.ok){for(let e=0;e<this.scopes.data.length;e++)if(this.scopes.data[e].scopeId==t.scopeId){this.scopes.data.splice(e,1),this.toast.show("Scope was removed!");break}this.scopes.data=JSON.parse(JSON.stringify(this.scopes.data))}else this.toast.show(e.error.message);this.loading=!1}))})})),disabled:[0,1,2,3,4]}]})}))}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.scopes.sort=this.sort,this.scopes.sort.active="url",this.scopes.sort.direction="asc",this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/scopes","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>{t&&this.list()})}ngOnDestroy(){this.subscriptions.add.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(a.a),c.Mb(l.a),c.Mb(d.a),c.Mb(p.b),c.Mb(u.a),c.Mb(b.a),c.Mb(h.a))},t.\u0275cmp=c.Gb({type:t,selectors:[["scopes-page"]],viewQuery:function(t,e){var o;1&t&&c.vc(n.a,!0),2&t&&c.oc(o=c.bc())&&(e.sort=o.first)},decls:17,vars:5,consts:[["mat-table","","fxShow","","fxHide.xs","true","matSort","",3,"dataSource"],["matColumnDef","app"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","url"],["matColumnDef","description"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["fxHide","","fxShow.xs","true"],["lines","full","matRipple","",3,"click",4,"ngFor","ngForOf"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""],["lines","full","matRipple","",3,"click"]],template:function(t,e){1&t&&(c.Sb(0,"table",0),c.Qb(1,1),c.zc(2,y,2,0,"th",2),c.zc(3,R,2,1,"td",3),c.Pb(),c.Qb(4,4),c.zc(5,k,2,0,"th",2),c.zc(6,O,2,1,"td",3),c.Pb(),c.Qb(7,5),c.zc(8,M,2,0,"th",2),c.zc(9,C,2,1,"td",3),c.Pb(),c.Qb(10,6),c.zc(11,D,1,0,"th",7),c.zc(12,x,4,0,"td",3),c.Pb(),c.zc(13,P,1,0,"tr",8),c.zc(14,A,1,0,"tr",9),c.Rb(),c.Sb(15,"mat-list",10),c.zc(16,B,6,2,"mat-list-item",11),c.Rb()),2&t&&(c.kc("dataSource",e.scopes),c.Ab(13),c.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),c.Ab(1),c.kc("matRowDefColumns",e.columns),c.Ab(2),c.kc("ngForOf",e.scopes.data))},directives:[r.j,m.a,n.a,r.c,r.e,r.b,r.g,r.i,f.a,g.k,r.d,n.b,r.a,v.a,w.a,r.f,r.h,f.b,S.o,I.f],styles:[".mat-column-options[_ngcontent-%COMP%]{width:40px;padding-right:16px!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row}"]}),t})();var z=o("Ovx2"),j=o("3Pt+"),q=o("xyCQ"),N=o("4jEk"),F=o("qFsG"),G=o("d3UM"),H=o("WJ5W"),Q=o("ZRfb"),$=o("AbOq");function J(t,e){if(1&t&&(c.Sb(0,"mat-error"),c.Bc(1),c.Rb()),2&t){const t=c.ec();c.Ab(1),c.Dc(" ",t.errors.url," ")}}function V(t,e){if(1&t&&(c.Sb(0,"mat-option",10),c.Bc(1),c.Rb()),2&t){const t=e.$implicit;c.kc("value",t.appId),c.Ab(1),c.Dc(" ",t.name," ")}}function L(t,e){if(1&t&&(c.Sb(0,"mat-error"),c.Bc(1),c.Rb()),2&t){const t=c.ec();c.Ab(1),c.Dc(" ",t.errors.appId," ")}}function E(t,e){if(1&t&&(c.Sb(0,"mat-error"),c.Bc(1),c.Rb()),2&t){const t=c.ec();c.Ab(1),c.Dc(" ",t.errors.description," ")}}const K=function(t){return{name:t}};let T=(()=>{class t{constructor(t,e,o,i,s,n,r){this.apps=t,this.toast=e,this.route=o,this.config=i,this.router=s,this.buttons=n,this.service=r,this.form=new j.f({url:new j.c(null,[j.v.required]),appId:new j.c(null,[j.v.required]),description:new j.c(null,[j.v.required])}),this.errors={url:"",appId:"",description:""},this.filter=new j.f({apps:new j.c("",[j.v.required])}),this.subscriptions={}}get(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["url","role","appId","description"],scopeId:this.scopeId});if(t.ok){const e=new s(t.result);e.role>=2?(this.form.controls.url.setValue(e.url),this.form.controls.appId.setValue(e.appId),this.form.controls.description.setValue(e.description)):(this.toast.show("You have insufficient rights to edit this scope!"),this.router.navigate(["/scopes"]))}else this.toast.show(t.error.message),this.router.navigate(["/scopes"]);this.loading=!1}))}load(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["role","name","icon","appId"]});t.ok?this.apps.data=t.result.map(t=>new z.a(t)).filter(t=>t.role>=2):(this.apps.data=[],this.toast.show(t.error.message)),this.loading=!1}))}submit(){return Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.scopeId);const e=yield this.service[t]({url:this.form.value.url,appId:this.form.value.appId,scopeId:this.scopeId,description:this.form.value.description});e.ok?this.router.navigate(["/scopes"]):this.toast.show(e.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/scopes"])}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(i.a)(this,void 0,void 0,(function*(){if(t){const t=this.route.snapshot.queryParams;this.mode=t.mode,this.scopeId=t.scopeId,"add"!=this.mode?(yield this.get(),yield this.load()):yield this.load()}})))}ngOnDestroy(){this.subscriptions.close.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(c.Mb(q.a),c.Mb(a.a),c.Mb(p.a),c.Mb(d.a),c.Mb(p.b),c.Mb(b.a),c.Mb(h.a))},t.\u0275cmp=c.Gb({type:t,selectors:[["scopes-editor-page"]],decls:24,vars:13,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["matInput","","type","url","name","url","placeholder","url","formControlName","url","required",""],[4,"ngIf"],["name","appId","placeholder","appId","formControlName","appId","required",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","apps"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[3,"value"]],template:function(t,e){1&t&&(c.Sb(0,"mat-content"),c.Sb(1,"form",0),c.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),c.Sb(2,"mat-form-field",1),c.Sb(3,"mat-label"),c.Bc(4," Url "),c.Rb(),c.Nb(5,"input",2),c.zc(6,J,2,1,"mat-error",3),c.Rb(),c.Sb(7,"mat-form-field",1),c.Sb(8,"mat-label"),c.Bc(9," App "),c.Rb(),c.Sb(10,"mat-select",4),c.Sb(11,"mat-option",5),c.Nb(12,"ngx-mat-select-search",6),c.Rb(),c.zc(13,V,2,2,"mat-option",7),c.fc(14,"filterBy"),c.Rb(),c.zc(15,L,2,1,"mat-error",3),c.Rb(),c.Sb(16,"mat-form-field",1),c.Sb(17,"mat-label"),c.Bc(18," Description "),c.Rb(),c.Nb(19,"input",8),c.zc(20,E,2,1,"mat-error",3),c.Rb(),c.Rb(),c.Rb(),c.Sb(21,"mat-footer"),c.Sb(22,"button",9),c.ac("click",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),c.Bc(23),c.Rb(),c.Rb()),2&t&&(c.Ab(1),c.kc("formGroup",e.form),c.Ab(5),c.kc("ngIf",e.errors.url),c.Ab(5),c.kc("formGroup",e.filter),c.Ab(2),c.kc("ngForOf",c.hc(14,8,e.apps.data,c.mc(11,K,e.filter.value.apps))),c.Ab(2),c.kc("ngIf",e.errors.appId),c.Ab(5),c.kc("ngIf",e.errors.description),c.Ab(2),c.kc("disabled",e.form.invalid),c.Ab(1),c.Dc(" ",e.mode," "))},directives:[N.a,j.w,j.p,j.g,I.c,I.f,F.a,j.b,j.o,j.e,j.u,g.l,G.a,S.k,H.a,g.k,Q.a,v.a,I.b],pipes:[$.a],styles:["[upload][_ngcontent-%COMP%]{width:100px;margin:auto;height:100px;border:2px solid transparent;display:flex;align-items:center;border-radius:100%;justify-content:center;background-color:#eee}[upload].required[_ngcontent-%COMP%]{border-color:red}mat-content[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column}mat-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{max-width:400px;margin-top:20px}mat-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;max-width:400px}mat-footer[_ngcontent-%COMP%]{justify-content:center}"]}),t})();var Z=o("wZkO"),U=o("R32p"),W=o("gyTc"),X=o("tVzd"),Y=o("YUcS"),tt=o("H0Zp"),et=o("p/0r");const ot=[{path:"",component:_},{path:"editor",component:T}];let it=(()=>{class t{}return t.\u0275mod=c.Kb({type:t}),t.\u0275inj=c.Jb({factory:function(e){return new(e||t)},imports:[[j.i,g.c,U.a,Z.a,w.b,f.c,W.a,n.c,r.l,F.b,S.p,G.b,v.b,X.a,tt.a,Y.a,et.a,I.e,j.t,H.b,p.f.forChild(ot)]]}),t})()}}]);