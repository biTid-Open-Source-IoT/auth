(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"4dGL":function(t,e,i){"use strict";i.r(e),i.d(e,"ScopesModule",(function(){return ot}));var o=i("mrSG");class s{constructor(t){this.app={},this.role=0,null!=t&&(null!=t.app&&(null!=t.app.name&&(this.app.name=t.app.name),null!=t.app.icon&&(this.app.icon=t.app.icon)),null!=t.role&&(this.role=t.role),null!=t.appId&&(this.appId=t.appId),null!=t.title&&(this.title=t.title),null!=t.scopeId&&(this.scopeId=t.scopeId),null!=t.description&&(this.description=t.description))}}var n=i("+0xr"),r=i("fXoL"),c=i("9ZKQ"),a=i("u0tM"),l=i("L7HW"),d=i("tyNb"),p=i("swrf"),b=i("BhS5"),u=i("a6VE"),h=i("znSr"),m=i("MutI"),f=i("ofXK"),g=i("bTqV"),y=i("NFeN"),v=i("FKr1"),w=i("kmnG");function I(t,e){1&t&&(r.Rb(0,"th",11),r.Ac(1," App "),r.Qb())}function O(t,e){if(1&t&&(r.Rb(0,"td",12),r.Ac(1),r.Qb()),2&t){const t=e.$implicit;r.Ab(1),r.Cc(" ",t.app," ")}}function R(t,e){1&t&&(r.Rb(0,"th",11),r.Ac(1," Scope "),r.Qb())}function A(t,e){if(1&t&&(r.Rb(0,"td",12),r.Ac(1),r.Qb()),2&t){const t=e.$implicit;r.Ab(1),r.Cc(" ",t.url," ")}}function C(t,e){1&t&&(r.Rb(0,"th",11),r.Ac(1," Description "),r.Qb())}function Q(t,e){if(1&t&&(r.Rb(0,"td",12),r.Ac(1),r.Qb()),2&t){const t=e.$implicit;r.Ab(1),r.Cc(" ",t.description," ")}}function j(t,e){1&t&&r.Mb(0,"th",11)}function k(t,e){if(1&t){const t=r.Sb();r.Rb(0,"td",12),r.Rb(1,"button",13),r.Zb("click",(function(){r.qc(t);const i=e.$implicit;return r.dc().options(i)})),r.Rb(2,"mat-icon"),r.Ac(3," more_vert "),r.Qb(),r.Qb(),r.Qb()}}function x(t,e){1&t&&r.Mb(0,"tr",14)}function M(t,e){1&t&&r.Mb(0,"tr",15)}function P(t,e){if(1&t){const t=r.Sb();r.Rb(0,"mat-list-item",16),r.Zb("click",(function(){r.qc(t);const i=e.$implicit;return r.dc().options(i)})),r.Rb(1,"mat-label"),r.Rb(2,"h3"),r.Ac(3),r.Qb(),r.Rb(4,"p"),r.Ac(5),r.Qb(),r.Qb(),r.Qb()}if(2&t){const t=e.$implicit;r.Ab(3),r.Cc(" ",t.app," "),r.Ab(2),r.Cc(" ",t.url," ")}}let L=(()=>{class t{constructor(t,e,i,o,s,r,c){this.toast=t,this.sheet=e,this.config=i,this.router=o,this.confirm=s,this.buttons=r,this.service=c,this.scopes=new n.k,this.columns=["app","url","description","options"],this.subscriptions={}}list(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({filter:["url","app","role","appId","roles","scopeId","description"]});this.scopes.data=t.ok?t.result.map(t=>new s(t)):[],this.loading=!1}))}options(t){return Object(o.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.title,options:[{icon:"edit",title:"Edit",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"update",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"content_copy",title:"Copy",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/scopes","editor"],{queryParams:{mode:"copy",scopeId:t.scopeId}})})),disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.confirm.show({message:"Are you sure you want to delete "+t.title+"?",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({scopeId:t.scopeId});if(e.ok){for(let e=0;e<this.scopes.data.length;e++)if(this.scopes.data[e].scopeId==t.scopeId){this.scopes.data.splice(e,1),this.toast.show("scope was removed!");break}this.scopes.data=JSON.parse(JSON.stringify(this.scopes.data))}else this.toast.show(e.error.message);this.loading=!1}))})})),disabled:[0,1,2,3,4]}]})}))}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/scopes","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>{t&&this.list()})}ngOnDestroy(){this.subscriptions.add.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(c.a),r.Lb(a.a),r.Lb(l.a),r.Lb(d.b),r.Lb(p.a),r.Lb(b.a),r.Lb(u.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["scopes-page"]],decls:17,vars:5,consts:[["mat-table","","fxShow","","fxHide.xs","true",3,"dataSource"],["matColumnDef","app"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","url"],["matColumnDef","description"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["fxHide","","fxShow.xs","true"],["lines","full","matRipple","",3,"click",4,"ngFor","ngForOf"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""],["lines","full","matRipple","",3,"click"]],template:function(t,e){1&t&&(r.Rb(0,"table",0),r.Pb(1,1),r.yc(2,I,2,0,"th",2),r.yc(3,O,2,1,"td",3),r.Ob(),r.Pb(4,4),r.yc(5,R,2,0,"th",2),r.yc(6,A,2,1,"td",3),r.Ob(),r.Pb(7,5),r.yc(8,C,2,0,"th",2),r.yc(9,Q,2,1,"td",3),r.Ob(),r.Pb(10,6),r.yc(11,j,1,0,"th",2),r.yc(12,k,4,0,"td",3),r.Ob(),r.yc(13,x,1,0,"tr",7),r.yc(14,M,1,0,"tr",8),r.Qb(),r.Rb(15,"mat-list",9),r.yc(16,P,6,2,"mat-list-item",10),r.Qb()),2&t&&(r.jc("dataSource",e.scopes),r.Ab(13),r.jc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),r.Ab(1),r.jc("matRowDefColumns",e.columns),r.Ab(2),r.jc("ngForOf",e.scopes.data))},directives:[n.j,h.a,n.c,n.e,n.b,n.g,n.i,m.a,f.k,n.d,n.a,g.a,y.a,n.f,n.h,m.b,v.o,w.f],styles:[".mat-column-options[_ngcontent-%COMP%]{width:40px;padding-right:16px!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row}"]}),t})();var D=i("Ovx2"),S=i("1oyR"),_=i("3Pt+"),q=i("xyCQ"),F=i("4jEk"),H=i("d3UM"),N=i("WJ5W"),G=i("qFsG"),Z=i("ZRfb"),$=i("AbOq");function J(t,e){if(1&t&&(r.Rb(0,"mat-option",10),r.Ac(1),r.Qb()),2&t){const t=e.$implicit;r.jc("value",t.appId),r.Ab(1),r.Cc(" ",t.name," ")}}function V(t,e){if(1&t&&(r.Rb(0,"mat-error"),r.Ac(1),r.Qb()),2&t){const t=r.dc();r.Ab(1),r.Cc(" ",t.errors.appId," ")}}function E(t,e){if(1&t&&(r.Rb(0,"mat-error"),r.Ac(1),r.Qb()),2&t){const t=r.dc();r.Ab(1),r.Cc(" ",t.errors.title," ")}}function K(t,e){if(1&t&&(r.Rb(0,"mat-error"),r.Ac(1),r.Qb()),2&t){const t=r.dc();r.Ab(1),r.Cc(" ",t.errors.description," ")}}const T=function(t){return{name:t}};let W=(()=>{class t{constructor(t,e,i,o,s,n,r){this.apps=t,this.toast=e,this.route=i,this.config=o,this.router=s,this.buttons=n,this.service=r,this.form=new _.f({appId:new _.c(null,[_.u.required]),title:new _.c(null,[_.u.required]),description:new _.c(null,[_.u.required])}),this.errors={appId:"",title:"",description:""},this.filter=new _.f({apps:new _.c("",[_.u.required])}),this.subscriptions={}}get(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","appId","title","description"],featureId:this.featureId});if(t.ok){const e=new S.a(t.result);e.role>=2?(this.form.controls.appId.setValue(e.appId),this.form.controls.title.setValue(e.title),this.form.controls.description.setValue(e.description)):(this.toast.show("You have insufficient rights to edit this feature!"),this.router.navigate(["/scopes"]))}else this.toast.show(t.error.message),this.router.navigate(["/scopes"]);this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["role","name","icon","appId"]});t.ok?this.apps.data=t.result.map(t=>new D.a(t)).filter(t=>t.role>=2):(this.apps.data=[],this.toast.show(t.error.message)),this.loading=!1}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.featureId);const e=yield this.service[t]({appId:this.form.value.appId,title:this.form.value.title,featureId:this.featureId,description:this.form.value.description});e.ok?this.router.navigate(["/scopes"]):this.toast.show(e.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/scopes"])}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){if(t){const t=this.route.snapshot.queryParams;this.mode=t.mode,this.featureId=t.featureId,"add"!=this.mode?(yield this.get(),yield this.load()):yield this.load()}})))}ngOnDestroy(){this.subscriptions.close.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(q.a),r.Lb(c.a),r.Lb(d.a),r.Lb(l.a),r.Lb(d.b),r.Lb(b.a),r.Lb(u.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["scopes-editor-page"]],decls:24,vars:13,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["name","appId","placeholder","appId","formControlName","appId","required",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","apps"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","text","name","title","placeholder","title","formControlName","title","required",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[3,"value"]],template:function(t,e){1&t&&(r.Rb(0,"mat-content"),r.Rb(1,"form",0),r.Zb("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),r.Rb(2,"mat-form-field",1),r.Rb(3,"mat-label"),r.Ac(4," App "),r.Qb(),r.Rb(5,"mat-select",2),r.Rb(6,"mat-option",3),r.Mb(7,"ngx-mat-select-search",4),r.Qb(),r.yc(8,J,2,2,"mat-option",5),r.ec(9,"filterBy"),r.Qb(),r.yc(10,V,2,1,"mat-error",6),r.Qb(),r.Rb(11,"mat-form-field",1),r.Rb(12,"mat-label"),r.Ac(13," Title "),r.Qb(),r.Mb(14,"input",7),r.yc(15,E,2,1,"mat-error",6),r.Qb(),r.Rb(16,"mat-form-field",1),r.Rb(17,"mat-label"),r.Ac(18," Description "),r.Qb(),r.Mb(19,"input",8),r.yc(20,K,2,1,"mat-error",6),r.Qb(),r.Qb(),r.Qb(),r.Rb(21,"mat-footer"),r.Rb(22,"button",9),r.Zb("click",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),r.Ac(23),r.Qb(),r.Qb()),2&t&&(r.Ab(1),r.jc("formGroup",e.form),r.Ab(5),r.jc("formGroup",e.filter),r.Ab(2),r.jc("ngForOf",r.gc(9,8,e.apps.data,r.lc(11,T,e.filter.value.apps))),r.Ab(2),r.jc("ngIf",e.errors.appId),r.Ab(5),r.jc("ngIf",e.errors.title),r.Ab(5),r.jc("ngIf",e.errors.description),r.Ab(2),r.jc("disabled",e.form.invalid),r.Ab(1),r.Cc(" ",e.mode," "))},directives:[F.a,_.v,_.p,_.g,w.c,w.f,H.a,_.o,_.e,_.t,v.k,N.a,f.k,f.l,G.a,_.b,Z.a,g.a,w.b],pipes:[$.a],styles:["[upload][_ngcontent-%COMP%]{width:100px;margin:auto;height:100px;border:2px solid transparent;display:flex;align-items:center;border-radius:100%;justify-content:center;background-color:#eee}[upload].required[_ngcontent-%COMP%]{border-color:red}mat-content[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column}mat-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{max-width:400px;margin-top:20px}mat-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;max-width:400px}mat-footer[_ngcontent-%COMP%]{justify-content:center}"]}),t})();var z=i("wZkO"),B=i("R32p"),U=i("gyTc"),X=i("tVzd"),Y=i("YUcS"),tt=i("H0Zp"),et=i("p/0r");const it=[{path:"",component:L},{path:"editor",component:W}];let ot=(()=>{class t{}return t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({factory:function(e){return new(e||t)},imports:[[_.i,f.c,B.a,z.a,y.b,m.c,U.a,n.l,G.b,v.p,H.b,g.b,X.a,tt.a,Y.a,et.a,w.e,_.s,N.b,d.f.forChild(it)]]}),t})()}}]);