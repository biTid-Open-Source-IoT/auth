(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{aDni:function(t,e,i){"use strict";i.r(e),i.d(e,"TokensModule",(function(){return ht}));var o=i("2xuv"),n=i("CSBE"),s=i("ofXK"),r=i("C6Ja"),a=i("NFeN"),c=i("STbY"),l=(i("R1ws"),i("FKr1")),b=i("fXoL");let d=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[l.g],l.g]}),t})();var p=i("+0xr"),u=i("qFsG"),m=i("d3UM"),h=i("0IaG"),f=i("bTqV"),g=i("J89Z"),k=i("/t3+"),y=i("O8lL"),C=i("1mZA"),v=i("EkoT"),x=i("kmnG"),T=i("mrSG"),I=i("AytR"),U=i("5ghV"),w=i("At5g"),O=i("RZmA"),A=i("SY5p"),D=i("eui8"),P=i("V6vf"),z=i("d3yR"),M=i("9ZKQ"),S=i("2ChS"),R=i("tyNb"),j=i("RgeU"),_=i("WF9o"),F=i("bv9b");function N(t,e){1&t&&b.Pb(0,"mat-progress-bar",21)}function q(t,e){1&t&&b.Pb(0,"th",22)}function G(t,e){if(1&t&&(b.Ub(0,"td",23),b.Pb(1,"img",24),b.Tb()),2&t){const t=e.$implicit;b.Cb(1),b.nc("src",t.app.icon,b.uc)}}function H(t,e){1&t&&(b.Ub(0,"th",25),b.Ac(1," app "),b.Tb())}function J(t,e){if(1&t&&(b.Ub(0,"td",26),b.Ac(1),b.Tb()),2&t){const t=e.$implicit;b.Cb(1),b.Cc(" ",t.app.name," ")}}function $(t,e){1&t&&(b.Ub(0,"th",25),b.Ac(1," description "),b.Tb())}function L(t,e){if(1&t&&(b.Ub(0,"td",26),b.Ac(1),b.Tb()),2&t){const t=e.$implicit;b.Cb(1),b.Cc(" ",t.description," ")}}function V(t,e){1&t&&(b.Ub(0,"th",25),b.Ac(1," expiry "),b.Tb())}function E(t,e){if(1&t&&(b.Ub(0,"td",27),b.Ac(1),b.hc(2,"date"),b.Tb()),2&t){const t=e.$implicit;b.Cb(1),b.Cc(" ",b.jc(2,1,t.expiry,"yyyy/MM/dd HH:mm:ss")," ")}}function Z(t,e){1&t&&(b.Ub(0,"th",25),b.Ac(1," scopes "),b.Tb())}function B(t,e){if(1&t&&(b.Ub(0,"td",26),b.Ac(1),b.Tb()),2&t){const t=e.$implicit;b.Cb(1),b.Cc(" ",t.scopes.length," ")}}function K(t,e){1&t&&(b.Ub(0,"th",25),b.Ac(1," role "),b.Tb())}function Q(t,e){if(1&t&&(b.Ub(0,"td",23),b.Ac(1),b.Tb()),2&t){const t=e.$implicit,i=b.gc();b.Cb(1),b.Cc(" ",i.GetRoleTitle(t.role)," ")}}function W(t,e){1&t&&b.Pb(0,"tr",28)}function X(t,e){if(1&t){const t=b.Vb();b.Ub(0,"tr",29),b.cc("click",(function(){b.tc(t);const i=e.$implicit;return b.gc().options(i)})),b.Tb()}}let Y=(()=>{class t{constructor(t,e,i,o,n,s,r){this.menu=t,this.toast=e,this.sheet=i,this.dialog=o,this.router=n,this.service=s,this.localstorage=r,this.sort={key:"description",reverse:!1},this.roles=I.a.roles,this.tokens=new p.k,this.columns=["icon","app","description","expiry","scopes","role"],this.subscriptions={}}list(){return Object(T.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({sort:{[this.sort.key]:this.sort.reverse?-1:1},filter:["app","role","device","expiry","scopes","tokenId","description"]});this.loading=!1,this.tokens.data=t.ok?t.result:[]}))}GetRoleTitle(t){let e;return this.roles.map(i=>{i.value==t&&(e=i.title)}),e}options(t){return Object(T.a)(this,void 0,void 0,(function*(){const e=yield this.sheet.open(A.a,{data:{role:t.role,title:t.description,options:[{icon:"visibility",title:"View",disabled:[0,1],optionId:0},{icon:"file_copy",title:"Copy",disabled:[0,1,2],optionId:1},{icon:"share",title:"Share",disabled:[0,1,2,3],optionId:2},{icon:"people",title:"Subscribers",disabled:[0,1,2,3],optionId:3},{icon:"delete",title:"Delete",disabled:[0,1,2,3,4],optionId:4},{icon:"remove",title:"unsubscribe",disabled:[5],optionId:5}]}});yield e.afterDismissed().subscribe(e=>Object(T.a)(this,void 0,void 0,(function*(){if(void 0!==e)switch(e){case 0:this.router.navigate(["/tokens",t.tokenId]);break;case 1:this.loading=!0;const e=yield this.service.retrieve({appId:t.app.appId,description:t.description});if(e.ok){const t=document.createElement("textarea");t.value=JSON.stringify(e.result.token),t.style.top="0px",t.style.left="0px",t.style.opacity="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.toast.success("token was copied to clipboard!")}else this.toast.error("there was an issue retrieving your token!");this.loading=!1;break;case 2:const i=yield this.dialog.open(U.a,{panelClass:"share-dialog",disableClose:!0});yield i.afterClosed().subscribe(e=>Object(T.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const i=yield this.service.share({role:e.role,email:e.email,tokenId:t.tokenId});this.loading=!1,i.ok?this.toast.success("user was shared to token!"):this.toast.error("issue sharing user to token!")}})));break;case 3:yield this.dialog.open(D.a,{data:{id:t.tokenId,type:"token",service:this.service},panelClass:"subscribers-dialog",disableClose:!0});break;case 4:const o=yield this.dialog.open(w.a,{panelClass:"delete-dialog",disableClose:!0});yield o.afterClosed().subscribe(e=>Object(T.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.service.revoke({tokenId:t.tokenId});if(this.loading=!1,e.ok){this.toast.success("token was deleted!");for(let e=0;e<this.tokens.data.length;e++)if(this.tokens.data[e].tokenId==t.tokenId){this.tokens.data.splice(e,1);break}this.tokens.data=JSON.parse(JSON.stringify(this.tokens.data))}else this.toast.error("issue deleting token!")}})));break;case 5:const n=yield this.dialog.open(P.a,{panelClass:"unsubscribe-dialog",disableClose:!0});yield n.afterClosed().subscribe(e=>Object(T.a)(this,void 0,void 0,(function*(){if(e){this.loading=!0;const e=yield this.service.unsubscribe({email:this.localstorage.get("email"),tokenId:t.tokenId});if(this.loading=!1,e.ok){this.toast.success("you were unsubscribed from token!");for(let e=0;e<this.tokens.data.length;e++)if(this.tokens.data[e].tokenId==t.tokenId){this.tokens.data.splice(e,1);break}this.tokens.data=JSON.parse(JSON.stringify(this.tokens.data))}else this.toast.error("issue unsubscribing from token!")}})))}})))}))}ngOnInit(){this.list(),this.subscriptions.search=this.search.change.subscribe(t=>{this.tokens.filter=t})}ngOnDestroy(){this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(z.a),b.Ob(M.a),b.Ob(S.b),b.Ob(h.b),b.Ob(R.b),b.Ob(j.a),b.Ob(_.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["app-tokens-page"]],viewQuery:function(t,e){var i;1&t&&b.xc(O.a,!0),2&t&&b.qc(i=b.dc())&&(e.search=i.first)},decls:33,vars:5,consts:[["color","primary"],["mat-icon-button","",1,"menu-toggle",3,"click"],[1,"page-label","spacer"],["placeholder","filter tokens"],["mat-icon-button","","routerLink","generate"],["mode","indeterminate","color","accent",4,"ngIf"],[1,"page-body"],["mat-table","",3,"dataSource"],["matColumnDef","icon"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","app"],["mat-header-cell","","text-uppercase","",4,"matHeaderCellDef"],["mat-cell","","text-uppercase","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","expiry"],["mat-cell","","text-lowercase","",4,"matCellDef"],["matColumnDef","scopes"],["matColumnDef","role"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mode","indeterminate","color","accent"],["mat-header-cell",""],["mat-cell",""],["alt","app icon",3,"src"],["mat-header-cell","","text-uppercase",""],["mat-cell","","text-uppercase",""],["mat-cell","","text-lowercase",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(t,e){1&t&&(b.Ub(0,"mat-toolbar",0),b.Ub(1,"button",1),b.cc("click",(function(){return e.menu.toggle()})),b.Ub(2,"mat-icon"),b.Ac(3," menu "),b.Tb(),b.Tb(),b.Ub(4,"div",2),b.Ac(5," tokens "),b.Tb(),b.Pb(6,"search",3),b.Ub(7,"button",4),b.Ub(8,"mat-icon"),b.Ac(9," add "),b.Tb(),b.Tb(),b.Tb(),b.zc(10,N,1,0,"mat-progress-bar",5),b.Ub(11,"div",6),b.Ub(12,"table",7),b.Sb(13,8),b.zc(14,q,1,0,"th",9),b.zc(15,G,2,1,"td",10),b.Rb(),b.Sb(16,11),b.zc(17,H,2,0,"th",12),b.zc(18,J,2,1,"td",13),b.Rb(),b.Sb(19,14),b.zc(20,$,2,0,"th",12),b.zc(21,L,2,1,"td",13),b.Rb(),b.Sb(22,15),b.zc(23,V,2,0,"th",12),b.zc(24,E,3,4,"td",16),b.Rb(),b.Sb(25,17),b.zc(26,Z,2,0,"th",12),b.zc(27,B,2,1,"td",13),b.Rb(),b.Sb(28,18),b.zc(29,K,2,0,"th",12),b.zc(30,Q,2,1,"td",10),b.Rb(),b.zc(31,W,1,0,"tr",19),b.zc(32,X,1,0,"tr",20),b.Tb(),b.Tb()),2&t&&(b.Cb(10),b.nc("ngIf",e.loading),b.Cb(2),b.nc("dataSource",e.tokens),b.Cb(19),b.nc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),b.Cb(1),b.nc("matRowDefColumns",e.columns))},directives:[k.a,f.a,a.a,O.a,R.c,s.l,p.j,p.c,p.e,p.b,p.g,p.i,F.a,p.d,p.a,p.f,p.h],pipes:[s.e],styles:[".mat-cell[_ngcontent-%COMP%]{min-width:100px}.mat-column-icon[_ngcontent-%COMP%]{width:60px;min-width:60px}.mat-column-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:40px;margin-top:5px;max-height:40px}.mat-row[_ngcontent-%COMP%]{cursor:pointer}.page-body[_ngcontent-%COMP%]{overflow-x:auto}"]}),t})();var tt=i("roMP");function et(t,e){1&t&&b.Pb(0,"mat-progress-bar",5)}function it(t,e){if(1&t&&(b.Ub(0,"tr"),b.Ub(1,"td"),b.Ac(2),b.Tb(),b.Ub(3,"td"),b.Ac(4),b.Tb(),b.Tb()),2&t){const t=e.$implicit,i=b.gc(2);b.Cb(2),b.Cc(" ",t.url," "),b.Cb(2),b.Cc(" ",i.GetRoleTitle(t.role)," ")}}function ot(t,e){if(1&t&&(b.Ub(0,"div",6),b.Ub(1,"div",7),b.Ub(2,"label"),b.Ac(3," app "),b.Tb(),b.Pb(4,"img",8),b.Ac(5),b.Tb(),b.Ub(6,"div",7),b.Ub(7,"label"),b.Ac(8," device "),b.Tb(),b.Ac(9),b.Tb(),b.Ub(10,"div",7),b.Ub(11,"label"),b.Ac(12," expiry "),b.Tb(),b.Ac(13),b.hc(14,"date"),b.Tb(),b.Ub(15,"div",7),b.Ub(16,"label"),b.Ac(17," scopes "),b.Tb(),b.Ub(18,"table"),b.zc(19,it,5,2,"tr",9),b.hc(20,"orderBy"),b.Tb(),b.Tb(),b.Tb()),2&t){const t=b.gc();b.Cb(4),b.nc("src",t.token.app.icon,b.uc),b.Cb(1),b.Dc(" ",t.token.app.name," (ID: ",t.token.app.appId,") "),b.Cb(4),b.Cc(" ",t.token.device," "),b.Cb(4),b.Cc(" ",b.jc(14,6,t.token.expiry,"yyyy/MM/dd HH:mm:ss")," "),b.Cb(6),b.nc("ngForOf",b.jc(20,9,t.token.scopes,"url"))}}let nt=(()=>{class t{constructor(t,e,i,o){this.route=t,this.toast=e,this.router=i,this.service=o,this.roles=I.a.roles,this.subscriptions={}}get(){return Object(T.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["app","role","device","expiry","scopes","tokenId","description"],tokenId:this.tokenId});this.loading=!1,t.ok?this.token=t.result:(this.router.navigate(["/tokens"]),this.toast.error("issue loading token!"))}))}GetRoleTitle(t){let e;return this.roles.map(i=>{i.value==t&&(e=i.title)}),e}ngOnInit(){this.subscriptions.route=this.route.params.subscribe(t=>{this.tokenId=t.tokenId,this.get()})}ngOnDestroy(){this.subscriptions.route.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(R.a),b.Ob(M.a),b.Ob(R.b),b.Ob(j.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["app-token-viewer"]],decls:8,vars:2,consts:[["color","primary"],[1,"page-label","spacer"],["mat-icon-button","","routerLink","/tokens"],["mode","indeterminate","color","accent",4,"ngIf"],["class","page-body",4,"ngIf"],["mode","indeterminate","color","accent"],[1,"page-body"],[1,"card"],["alt","app icon",3,"src"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(b.Ub(0,"mat-toolbar",0),b.Ub(1,"div",1),b.Ac(2," token viewer "),b.Tb(),b.Ub(3,"button",2),b.Ub(4,"mat-icon"),b.Ac(5," close "),b.Tb(),b.Tb(),b.Tb(),b.zc(6,et,1,0,"mat-progress-bar",3),b.zc(7,ot,21,12,"div",4)),2&t&&(b.Cb(6),b.nc("ngIf",e.loading),b.Cb(1),b.nc("ngIf",e.token))},directives:[k.a,f.a,R.c,a.a,s.l,F.a,s.k],pipes:[s.e,tt.a],styles:[".card[_ngcontent-%COMP%]{width:400px;margin:15px auto;border:1px solid #e0e0e0;padding:10px 16px;display:flex;position:relative;min-height:46px;align-items:center;border-radius:4px}.card[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{top:-6px;left:5px;color:#616161;padding:0 5px;z-index:1;position:absolute;font-size:12px;line-height:12px;text-transform:uppercase;background-color:#fafafa}.card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:30px;max-height:30px;margin-right:15px}@media screen and (max-width:420px){.card[_ngcontent-%COMP%]{flex:1 auto;width:auto;margin:15px 5px}}"]}),t})();var st=i("3Pt+"),rt=i("dWDE"),at=i("xyCQ");function ct(t,e){1&t&&b.Pb(0,"mat-progress-bar",14)}function lt(t,e){if(1&t&&(b.Ub(0,"mat-option",15),b.Ac(1),b.Tb()),2&t){const t=e.$implicit;b.nc("value",t.appId),b.Cb(1),b.Cc(" ",t.name," ")}}function bt(t,e){if(1&t&&(b.Ub(0,"mat-error"),b.Ac(1),b.Tb()),2&t){const t=b.gc();b.Cb(1),b.Cc(" ",t.errors.appId," ")}}function dt(t,e){if(1&t&&(b.Ub(0,"mat-error"),b.Ac(1),b.Tb()),2&t){const t=b.gc();b.Cb(1),b.Cc(" ",t.errors.expiry," ")}}function pt(t,e){if(1&t&&(b.Ub(0,"mat-error"),b.Ac(1),b.Tb()),2&t){const t=b.gc();b.Cb(1),b.Cc(" ",t.errors.description," ")}}const ut=[{path:"",component:Y},{path:"generate",component:(()=>{class t{constructor(t,e,i,o,n){this.toast=t,this.router=e,this.service=i,this.formerror=o,this.appsservice=n,this.apps=[],this.form=new st.d({appId:new st.b("",[st.p.required]),expiry:new st.b("",[st.p.required]),description:new st.b("",[st.p.required])}),this.roles=I.a.roles,this.errors={appId:"",expiry:"",description:""},this.subscriptions={}}load(){return Object(T.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.appsservice.list({filter:["name","appId"]});this.loading=!1,t.ok?this.apps=t.result:(this.router.navigate(["/tokens"]),this.toast.error("issue loading apps!"))}))}submit(){return Object(T.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.generate({appId:this.form.value.appId,expiry:this.form.value.expiry,description:this.form.value.description});this.loading=!1,t.ok?(this.router.navigate(["/tokens"]),this.toast.success("token was generated!")):(this.router.navigate(["/tokens"]),this.toast.error("issue generating token!"))}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(M.a),b.Ob(R.b),b.Ob(j.a),b.Ob(rt.a),b.Ob(at.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["app-generate-token"]],decls:28,vars:9,consts:[["color","primary"],[1,"page-label","spacer"],["mat-icon-button","","routerLink","/tokens"],["mode","indeterminate","color","accent",4,"ngIf"],[1,"page-body"],[3,"formGroup","ngSubmit"],["appearance","outline"],["text-uppercase",""],["name","appId","placeholder","app","formControlName","appId","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","date","name","expiry","placeholder","expiry","formControlName","expiry","required",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","submit","mat-flat-button","","color","primary"],["mode","indeterminate","color","accent"],[3,"value"]],template:function(t,e){1&t&&(b.Ub(0,"mat-toolbar",0),b.Ub(1,"div",1),b.Ac(2," generate token "),b.Tb(),b.Ub(3,"button",2),b.Ub(4,"mat-icon"),b.Ac(5," close "),b.Tb(),b.Tb(),b.Tb(),b.zc(6,ct,1,0,"mat-progress-bar",3),b.Ub(7,"div",4),b.Ub(8,"form",5),b.cc("ngSubmit",(function(){return!e.form.invalid&&!e.loading&&e.submit()})),b.Ub(9,"mat-form-field",6),b.Ub(10,"mat-label",7),b.Ac(11," app "),b.Tb(),b.Ub(12,"mat-select",8),b.zc(13,lt,2,2,"mat-option",9),b.hc(14,"orderBy"),b.Tb(),b.zc(15,bt,2,1,"mat-error",10),b.Tb(),b.Ub(16,"mat-form-field",6),b.Ub(17,"mat-label",7),b.Ac(18," expiry "),b.Tb(),b.Pb(19,"input",11),b.zc(20,dt,2,1,"mat-error",10),b.Tb(),b.Ub(21,"mat-form-field",6),b.Ub(22,"mat-label",7),b.Ac(23," description "),b.Tb(),b.Pb(24,"input",12),b.zc(25,pt,2,1,"mat-error",10),b.Tb(),b.Ub(26,"button",13),b.Ac(27," submit "),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Cb(6),b.nc("ngIf",e.loading),b.Cb(2),b.nc("formGroup",e.form),b.Cb(5),b.nc("ngForOf",b.jc(14,6,e.apps,"name")),b.Cb(2),b.nc("ngIf",e.errors.appId),b.Cb(5),b.nc("ngIf",e.errors.expiry),b.Cb(5),b.nc("ngIf",e.errors.description))},directives:[k.a,f.a,R.c,a.a,s.l,st.q,st.j,st.e,x.c,x.g,m.a,st.i,st.c,st.o,s.k,u.a,st.a,F.a,l.k,x.b],pipes:[tt.a],styles:["form[_ngcontent-%COMP%]{width:400px;margin:auto}@media screen and (max-width:420px){form[_ngcontent-%COMP%]{width:calc(100% - 20px)}}"]}),t})()},{path:":tokenId",component:nt}];let mt=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[R.e.forChild(ut)],R.e]}),t})(),ht=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[st.f,o.a,s.c,n.a,r.a,a.b,c.a,d,u.b,p.l,m.b,h.c,f.b,g.a,k.b,y.a,C.a,v.a,x.e,mt,st.n,S.c,F.b]]}),t})()}}]);