<mat-toolbar color="primary">
    <div class="page-label spacer">
        {{ mode == 'add' ? 'add app' : '' }}
        {{ mode == 'copy' ? 'copy app' : '' }}
        {{ mode == 'update' ? 'update app' : '' }}
    </div>

    <button mat-icon-button routerLink="/apps">
        <mat-icon>
            close
        </mat-icon>
    </button>
</mat-toolbar>

<mat-progress-bar mode="indeterminate" color="accent" *ngIf="loading"></mat-progress-bar>

<form [formGroup]="form" (ngSubmit)="!form.invalid && submit()">
    <app-image-upload [value]="form.value.icon" [required]="!form.value.icon || errors.icon"></app-image-upload>

    <mat-form-field appearance="outline">
        <mat-label text-uppercase>
            name
        </mat-label>
        
        <input matInput type="text" name="name" placeholder="name" formControlName="name" required>

        <mat-error *ngIf="errors.name">
            {{ errors.name }}
        </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
        <mat-label text-uppercase>
            domains
        </mat-label>

        <mat-chip-list #domainchips aria-label="Fruit selection">
            <mat-chip *ngFor="let domain of domains" [removable]="true" (removed)="RemoveDomain(domain)">
                {{ domain }}
                
                <mat-icon matChipRemove>
                    cancel
                </mat-icon>
            </mat-chip>
          
            <input placeholder="domain..." [matChipInputFor]="domainchips" [matChipInputSeparatorKeyCodes]="keyscodes" [matChipInputAddOnBlur]="true" (matChipInputTokenEnd)="AddDomain($event)">
        </mat-chip-list>
    </mat-form-field>

    <mat-form-field appearance="outline">
        <mat-label text-uppercase>
            scopes
        </mat-label>

        <mat-chip-list #scopechips aria-label="Fruit selection">
            <mat-chip *ngFor="let scope of scopes" [removable]="true" (removed)="RemoveScope(scope)">
                {{ scope }}
                
                <mat-icon matChipRemove>
                    cancel
                </mat-icon>
            </mat-chip>
          
            <input #scopeinput placeholder="scope..." [matAutocomplete]="auto" [matChipInputFor]="scopechips">
          
            <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let option of options | filterBy : 'url' : scopeinput.value" [value]="option.url" (click)="AddScope(option.url, scopeinput)">
                    {{ option.url }}
                </mat-option>
            </mat-autocomplete>
        </mat-chip-list>
    </mat-form-field>
    
    <section>
        <mat-form-field appearance="outline">
            <mat-label text-uppercase>
                theme color
            </mat-label>
            
            <input matInput type="color" name="color" placeholder="theme color" formControlName="color" required>
    
            <mat-error *ngIf="errors.color">
                {{ errors.color }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label text-uppercase>
                theme background
            </mat-label>
            
            <input matInput type="color" name="background" placeholder="theme background" formControlName="background" required>
    
            <mat-error *ngIf="errors.background">
                {{ errors.background }}
            </mat-error>
        </mat-form-field>
    </section>

    <mat-form-field appearance="outline">
        <mat-label text-uppercase>
            secret
        </mat-label>
        
        <input matInput type="text" name="secret" placeholder="secret" formControlName="secret" required>

        <mat-error *ngIf="errors.secret">
            {{ errors.secret }}
        </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
        <mat-label text-uppercase>
            sharing rules
        </mat-label>
        
        <mat-select name="organizationOnly" placeholder="sharing rules" formControlName="organizationOnly" required>
            <mat-option [value]="0">
                Anyone Can Share
            </mat-option>

            <mat-option [value]="1">
                In Organization Only
            </mat-option>
        </mat-select>

        <mat-error *ngIf="errors.organizationOnly">
            {{ errors.organizationOnly }}
        </mat-error>
    </mat-form-field>

    <button type="submit" mat-flat-button color="primary">
        submit
    </button>
</form>